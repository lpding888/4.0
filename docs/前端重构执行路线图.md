# 🚀 前端重构执行路线图（6阶段 · 详细版）

> **最后更新：2025-10-31**
> **艹！这是前端重构的总作战地图，必须严格按照这个顺序执行！**

---

## 📊 总体规划概览

### 核心目标
1. ✅ **消灭670行硬编码** - 功能配置数据驱动
2. ✅ **代码复用率提升70%** - 通用组件和Hooks
3. ✅ **安全性加固** - 完整的权限管理系统
4. ✅ **开发效率提升3倍** - 工业级API请求封装

### 6个核心任务卡
| 任务ID | 任务名称 | 优先级 | 预计工时 | 依赖 |
|--------|---------|--------|---------|------|
| TASK-FE-001 | 整体架构搭建 | P0 | 3-5天 | 无 |
| TASK-FE-006 | API请求封装 | P0 | 3-4天 | FE-001 |
| TASK-FE-002 | 功能配置管理 | P0 | 2-3天 | FE-001, FE-006 |
| TASK-FE-005 | 权限路由系统 | P0 | 3-4天 | FE-001 |
| TASK-FE-004 | 数据表格系统 | P1 | 3-4天 | FE-001, FE-006 |
| TASK-FE-003 | 动态表单系统 | P1 | 4-5天 | FE-001, FE-006 |

### 总预计工时
- **P0任务（必须完成）**：11-16天
- **P1任务（重要）**：7-9天
- **总计**：18-25天（约3-4周）

---

## 📅 分阶段执行计划

### 🔥 Phase 1：基础设施搭建（Week 1）

**时间：第1周（5个工作日）**

#### 任务清单
| 任务 | 负责人 | 工时 | 状态 |
|------|--------|------|------|
| ✅ TASK-FE-001：整体架构搭建 | frontend-dev | 3-5天 | ⏳ 待开始 |
| ✅ TASK-FE-006：API请求封装 | frontend-dev | 3-4天 | ⏳ 待开始 |

#### 详细步骤

**Day 1-2：TASK-FE-001 - 目录结构搭建**
```bash
# Step 1: 创建FSD目录结构
mkdir -p frontend/src/{features,entities,shared,widgets}
mkdir -p frontend/src/shared/{ui,api,hooks,utils,constants,types}

# Step 2: 配置TypeScript严格模式
# 创建 shared/types/global.d.ts

# Step 3: 安装依赖
npm install zustand
npm install @ant-design/nextjs-registry
```

**关键交付物：**
- ✅ FSD目录结构完整创建
- ✅ `shared/types/global.d.ts` 定义所有核心类型
- ✅ `useAuthStore` 和 `useFeatureStore` 已实现
- ✅ Ant Design主题配置（主色#5B61ED）

**Day 3-5：TASK-FE-006 - API请求系统**
```typescript
// Step 1: 创建axios客户端
// shared/api/client.ts

// Step 2: 实现useRequest Hook
// shared/hooks/useRequest.ts

// Step 3: 实现useMutation Hook
// shared/hooks/useMutation.ts
```

**关键交付物：**
- ✅ `apiClient`配置完成（拦截器、错误处理）
- ✅ `useRequest` Hook支持缓存、重试、取消
- ✅ `useMutation` Hook支持POST/PUT/DELETE
- ✅ Token过期自动跳转登录

**验收标准：**
- [ ] `npm run build` 无TypeScript错误
- [ ] 访问`/workspace`，API请求自动添加Token
- [ ] Token过期时自动跳转到`/login`

---

### ⚡ Phase 2：核心功能重构（Week 2）

**时间：第2周（5个工作日）**

#### 任务清单
| 任务 | 负责人 | 工时 | 状态 |
|------|--------|------|------|
| ✅ TASK-FE-002：功能配置管理 | frontend-dev | 2-3天 | ⏳ 待开始 |
| ✅ TASK-FE-005：权限路由系统 | frontend-dev | 3-4天 | ⏳ 待开始 |

#### 详细步骤

**Day 1-3：TASK-FE-002 - 动态功能加载**
```typescript
// Step 1: 创建DynamicIcon组件
// shared/ui/DynamicIcon/index.tsx

// Step 2: 创建FeatureCard组件
// features/workspace/ui/FeatureCard/index.tsx

// Step 3: 创建FeatureGrid组件
// features/workspace/ui/FeatureGrid/index.tsx

// Step 4: 改造WorkspacePage
// features/workspace/ui/WorkspacePage.tsx
```

**关键交付物：**
- ✅ `DynamicIcon`支持字符串动态渲染Ant Design图标
- ✅ `FeatureCard`和`FeatureGrid`通用组件
- ✅ 功能列表从后端API动态加载
- ✅ **删除`page.tsx`中的670行硬编码**

**Day 4-5：TASK-FE-005 - 权限系统**
```typescript
// Step 1: 创建middleware路由守卫
// app/middleware.ts

// Step 2: 创建PermissionGuard组件
// shared/ui/PermissionGuard/index.tsx

// Step 3: 创建usePermission Hook
// shared/hooks/usePermission.ts

// Step 4: 改造Sidebar动态菜单
// widgets/Sidebar/index.tsx
```

**关键交付物：**
- ✅ Next.js Middleware路由守卫生效
- ✅ `PermissionGuard`组件保护敏感页面
- ✅ 导航菜单根据角色动态显示
- ✅ 普通用户无法访问`/admin`

**验收标准：**
- [ ] 访问`/workspace`，功能列表从后端加载
- [ ] 后端修改`feature_definitions`表，前端立即变化
- [ ] 未登录用户访问`/admin`自动跳转登录
- [ ] 普通用户访问`/admin`显示403错误

---

### 🎯 Phase 3：管理后台重构（Week 3）

**时间：第3周（5个工作日）**

#### 任务清单
| 任务 | 负责人 | 工时 | 状态 |
|------|--------|------|------|
| ✅ TASK-FE-004：数据表格系统 | frontend-dev | 3-4天 | ⏳ 待开始 |

#### 详细步骤

**Day 1-4：TASK-FE-004 - 通用表格系统**
```typescript
// Step 1: 实现usePagination Hook
// shared/hooks/usePagination.ts

// Step 2: 实现useTableData Hook
// shared/hooks/useTableData.ts

// Step 3: 实现useTableFilter Hook
// shared/hooks/useTableFilter.ts

// Step 4: 创建DataTable通用组件
// shared/ui/DataTable/index.tsx

// Step 5: 创建FilterBar通用组件
// shared/ui/FilterBar/index.tsx

// Step 6: 改造用户管理页面
// features/admin/ui/UserManagementPage.tsx
```

**关键交付物：**
- ✅ `usePagination/useTableData/useTableFilter` Hooks
- ✅ `DataTable`和`FilterBar`通用组件
- ✅ 用户管理页面使用新的表格系统
- ✅ 订单管理、任务监控等页面逐步迁移

**验收标准：**
- [ ] 用户管理页面分页、筛选、刷新正常工作
- [ ] 代码量相比旧版减少>70%
- [ ] 自动刷新（30秒）不影响用户操作

---

### 🚀 Phase 4：动态表单系统（Week 4）

**时间：第4周（5个工作日）**

#### 任务清单
| 任务 | 负责人 | 工时 | 状态 |
|------|--------|------|------|
| ✅ TASK-FE-003：动态表单系统 | frontend-dev | 4-5天 | ⏳ 待开始 |

#### 详细步骤

**Day 1-5：TASK-FE-003 - JSON Schema驱动表单**
```typescript
// Step 1: 定义FormSchema类型
// shared/types/form-schema.d.ts

// Step 2: 实现字段渲染器
// shared/ui/DynamicForm/FieldRenderers.tsx

// Step 3: 实现验证规则生成器
// shared/ui/DynamicForm/ValidationRules.ts

// Step 4: 创建DynamicForm组件
// shared/ui/DynamicForm/index.tsx

// Step 5: 改造功能配置页面
// features/admin/ui/FeatureConfigPage.tsx
```

**关键交付物：**
- ✅ 支持12种字段类型（text/number/enum/image_upload等）
- ✅ 根据JSON Schema自动生成验证规则
- ✅ 功能配置页面使用动态表单
- ✅ 后端修改`form_schemas`表，前端表单立即变化

**验收标准：**
- [ ] 支持所有12种字段类型
- [ ] 必填、最小值、最大值验证正常工作
- [ ] 图片上传支持大小限制和格式限制
- [ ] 表单提交返回正确的数据格式

---

### 🎨 Phase 5：UI/UX优化（Week 5 - Optional）

**时间：第5周（根据实际情况决定）**

#### 任务清单
| 任务 | 优先级 | 工时 |
|------|--------|------|
| 实现骨架屏Loading | P2 | 1天 |
| 优化移动端响应式 | P2 | 2天 |
| 添加页面过渡动画 | P2 | 1天 |
| 实现暗黑模式 | P2 | 2天 |

**这个阶段可选，优先完成前4个Phase！**

---

### ✅ Phase 6：测试与上线（Week 6）

**时间：第6周（2-3个工作日）**

#### 任务清单
| 任务 | 负责人 | 工时 | 状态 |
|------|--------|------|------|
| E2E测试覆盖 | qa-acceptance | 1天 | ⏳ 待开始 |
| 代码审查与修复 | reviewer | 1天 | ⏳ 待开始 |
| 性能优化 | frontend-dev | 1天 | ⏳ 待开始 |
| 部署上线 | codebuddy-deploy | 0.5天 | ⏳ 待开始 |

#### 测试清单

**功能测试**
- [ ] 未登录用户访问`/workspace`自动跳转登录
- [ ] 普通用户无法访问`/admin`
- [ ] 分销代理可以访问`/distribution`
- [ ] 功能列表从后端动态加载
- [ ] 表格分页、筛选、刷新正常工作
- [ ] 动态表单所有字段类型正常工作

**性能测试**
- [ ] 首屏加载时间 < 2秒
- [ ] API请求缓存生效，5分钟内不重复请求
- [ ] 表格自动刷新不影响用户操作

**安全测试**
- [ ] Token过期自动跳转登录
- [ ] 前端绕过权限检查，后端API仍然拒绝
- [ ] XSS/CSRF防护测试

---

## 📋 每周检查清单

### Week 1 验收
- [ ] FSD目录结构完整
- [ ] TypeScript严格模式无错误
- [ ] `useRequest`和`useMutation` Hook可用
- [ ] Ant Design主题配置生效

### Week 2 验收
- [ ] 功能列表从后端动态加载
- [ ] 670行硬编码已删除
- [ ] 权限系统正常工作
- [ ] 导航菜单根据角色动态显示

### Week 3 验收
- [ ] 用户管理页面使用新表格系统
- [ ] 代码量相比旧版减少>70%
- [ ] 至少3个表格页面已迁移

### Week 4 验收
- [ ] 动态表单支持12种字段类型
- [ ] 功能配置页面使用动态表单
- [ ] 后端修改Schema，前端表单立即变化

---

## 🚨 风险控制

### 风险1：后端API不兼容
- **概率：中**
- **影响：高**
- **缓解措施：**
  - 提前与后端对齐API接口格式
  - 确保`feature_definitions`和`form_schemas`表已创建
  - 后端优先实现`GET /api/features`

### 风险2：TypeScript类型错误
- **概率：高**
- **影响：中**
- **缓解措施：**
  - 优先定义`global.d.ts`中的所有类型
  - 使用`@ts-ignore`临时跳过，标注TODO
  - 逐步补全类型定义

### 风险3：时间延期
- **概率：中**
- **影响：中**
- **缓解措施：**
  - P0任务优先完成，P1/P2任务可延后
  - 每天晚上Review进度，及时调整
  - 遇到阻塞问题立即求助

---

## 💡 实施建议

### 开发流程
1. **每完成一个子任务就Git提交**
   ```bash
   git add .
   git commit -m "feat(frontend): 完成DynamicIcon组件"
   ```

2. **保留旧代码，逐步迁移**
   - 不要一次性删除所有旧代码
   - 新旧代码并存，验证通过后再删除

3. **使用Feature Flag**
   ```typescript
   const USE_NEW_WORKSPACE = process.env.NEXT_PUBLIC_USE_NEW_WORKSPACE === 'true';
   ```

### 团队协作
- **Daily Standup**：每天早上10点同步进度
- **Code Review**：每个任务完成后由reviewer审查
- **文档更新**：每完成一个Phase更新README

---

## 📚 参考资料索引

| 文档 | 路径 |
|------|------|
| **任务卡总览** | `tasks/frontend-refactoring/` |
| **前端架构设计** | `docs/GPT5问题-前端架构设计.md` |
| **后端架构说明** | `docs/后端架构说明.md` |
| **项目交付物总览** | `docs/项目交付物总览-主索引.md` |

---

## 🎯 成功标准

### 代码质量
- ✅ TypeScript严格模式无错误
- ✅ ESLint检查通过（0 warnings）
- ✅ 代码复用率提升>70%

### 功能完整性
- ✅ 所有P0任务100%完成
- ✅ 至少80% P1任务完成

### 性能指标
- ✅ 首屏加载时间 < 2秒
- ✅ API请求缓存命中率 > 60%

### 用户体验
- ✅ 功能配置数据驱动，产品经理可自行调整
- ✅ 权限系统完整，无安全漏洞
- ✅ 表格加载流畅，无卡顿

---

**艹！这个路线图就是你的作战指挥部，严格按照这个执行，保证3-4周内完成前端重构！** 🔥

**接下来的执行顺序：**
1. ✅ **本周立即开始 Phase 1**（基础设施搭建）
2. ⏰ **下周开始 Phase 2**（核心功能重构）
3. 🎯 **第3周开始 Phase 3**（管理后台重构）
4. 🚀 **第4周开始 Phase 4**（动态表单系统）
5. ✅ **第5-6周测试上线**

**现在就去干！别犹豫！** 💪
