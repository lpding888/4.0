# GPT-5专用问题：前端架构设计与优化

## 📋 问题背景

我们的AI服装处理SaaS产品前端使用Next.js 14 + TypeScript + Ant Design开发，目前存在以下严重问题：

### 当前痛点

1. **代码重复严重**
   - `page.tsx` 670行，大量硬编码的功能配置
   - 每个页面都重复写相似的布局代码
   - 功能卡片、表单组件、数据展示逻辑到处复制粘贴

2. **组件职责不清**
   - 页面组件包含太多业务逻辑（API调用、状态管理、UI渲染混在一起）
   - 缺少清晰的组件分层（容器组件 vs 展示组件）
   - 组件复用性差

3. **状态管理混乱**
   - 使用Zustand但状态划分不合理
   - 有些状态该放全局的放在了组件内
   - 有些状态该放组件内的放在了全局
   - 缺少统一的异步状态管理方案

4. **路由结构不清晰**
   - 页面路由缺少统一规划
   - 权限控制散落在各个页面
   - 缺少路由守卫和统一的权限验证

5. **样式管理混乱**
   - Ant Design主题定制不统一
   - 自定义样式到处写，缺少设计系统
   - 响应式布局不统一

6. **类型定义不规范**
   - TypeScript类型定义散落各处
   - 缺少统一的类型管理
   - API响应类型和前端类型不一致

---

## 🎯 核心需求

我们需要GPT-5帮助设计一套**工业级、可扩展、易维护**的前端架构，解决以上所有问题。

---

## 📝 给GPT-5的完整提问

### 问题1：整体架构设计

```
我们的AI服装处理SaaS产品前端使用Next.js 14 (App Router) + TypeScript + Ant Design 5开发。

核心业务模块：
1. 用户模块（登录/注册/个人中心）
2. 会员套餐（购买/续费/配额管理）
3. AI功能工作台（20+个AI功能：抠图/换脸/换装/视频处理等）
4. 素材库（用户作品管理）
5. 分销代理（邀请/佣金/提现）
6. 管理后台（用户管理/功能配置/流水线编排/数据统计）

技术栈限制：
- 必须使用Next.js 14 App Router
- 必须使用Ant Design 5（不能换成其他UI库）
- 必须使用TypeScript严格模式
- 状态管理：Zustand（已在用）
- API请求：axios（已封装）

当前痛点：
- 代码重复严重（功能配置、布局、表单到处复制粘贴）
- 组件职责不清（页面组件包含太多业务逻辑）
- 状态管理混乱（全局状态和组件状态划分不合理）
- 路由权限控制散落各处
- 类型定义不规范

请帮我设计一套完整的前端架构，包括：

1. **目录结构设计**（分层清晰、职责明确）
   - src/目录下应该有哪些一级目录？
   - 每个目录的职责是什么？
   - 如何组织页面/组件/hooks/utils/types？

2. **组件分层策略**
   - 如何划分容器组件(Container)、展示组件(Presentation)、布局组件(Layout)？
   - 如何实现组件复用？
   - 如何避免组件职责过重？

3. **状态管理方案**
   - 哪些状态应该放全局（Zustand store）？
   - 哪些状态应该放组件内（useState）？
   - 如何管理异步状态（loading/error/data）？
   - 如何设计store的划分（按业务模块还是按功能类型）？

4. **路由与权限管理**
   - 如何设计路由结构？
   - 如何实现路由守卫（未登录跳转登录、管理员权限验证）？
   - 如何管理路由配置（避免硬编码）？

5. **类型系统设计**
   - 如何组织TypeScript类型定义？
   - 如何保证API响应类型和前端类型一致？
   - 如何复用类型定义（避免重复定义）？

6. **样式与设计系统**
   - 如何定制Ant Design主题？
   - 如何组织自定义样式（CSS Modules / Tailwind / CSS-in-JS）？
   - 如何实现响应式布局的统一规范？

请给出：
- 完整的目录结构（树形图）
- 每个模块的职责说明
- 关键代码示例（3-5个核心模块的代码骨架）
- 最佳实践建议
```

---

### 问题2：功能配置管理（解决硬编码问题）

```
我们的AI功能工作台有20+个功能（抠图、换脸、换装、视频处理等），目前在page.tsx中硬编码了670行配置：

当前代码问题：
```typescript
// src/app/page.tsx (670行硬编码)
const allFeatures = [
  {
    id: 'basic_clean',
    name: '智能抠图',
    icon: <ScissorOutlined />,
    category: '基础处理',
    description: '一键去除背景，生成透明底或纯色底商品图',
    features: ['自动识别主体', '边缘精细处理', '支持批量处理'],
    quota: '1配额/张',
    status: 'available',
    gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
  },
  // ...重复20次
];
```

这种硬编码导致：
1. 新增功能要修改page.tsx（违背开闭原则）
2. 功能配置无法动态管理
3. 代码难以维护

我们的后端已经有`feature_definitions`表存储功能配置，包含：
- feature_id, name, description, icon, quota_cost, status等字段

请帮我设计一套**功能配置驱动**的架构：

1. **数据驱动方案**
   - 如何从后端API动态加载功能配置？
   - 如何设计前端的功能配置数据结构（TypeScript类型）？
   - 如何缓存功能配置（避免每次都请求）？

2. **组件抽象**
   - 如何设计通用的FeatureCard组件（渲染任意功能卡片）？
   - 如何设计FeatureGrid组件（渲染功能列表）？
   - 如何支持不同的卡片样式（带渐变、带标签、带动画）？

3. **图标管理**
   - 如何管理20+个功能的图标（避免硬编码<ScissorOutlined />）？
   - 后端返回icon字段（字符串"ScissorOutlined"），前端如何动态渲染对应的Ant Design图标？

4. **配置扩展性**
   - 如何支持功能分类（基础处理、AI模特、视频处理）？
   - 如何支持功能筛选（按分类、按状态）？
   - 如何支持功能排序（热门优先、新功能优先）？

请给出：
- 完整的数据结构设计（TypeScript类型）
- FeatureCard/FeatureGrid组件代码示例
- 动态图标渲染方案
- API数据加载与缓存策略
```

---

### 问题3：表单与动态表单系统

```
我们的管理后台需要配置20+个AI功能的表单，每个功能的表单字段不同：

示例：
- 智能抠图：只需上传图片
- AI换装：需要上传图片 + 选择服装风格 + 调整参数
- 视频处理：需要上传视频 + 选择处理类型 + 设置时长范围

当前问题：
1. 每个功能都硬编码一个表单组件（20+个重复代码）
2. 表单验证逻辑重复
3. 表单提交逻辑重复

我们的后端有`form_schemas`表存储表单配置（JSON Schema格式）：
```json
{
  "feature_id": "outfit_change",
  "form_schema": {
    "fields": [
      {
        "name": "image",
        "type": "image_upload",
        "label": "上传图片",
        "required": true,
        "validation": { "maxSize": "10MB", "accept": ["jpg", "png"] }
      },
      {
        "name": "style",
        "type": "enum",
        "label": "服装风格",
        "options": ["商务正装", "休闲装", "运动装"],
        "required": true
      },
      {
        "name": "intensity",
        "type": "number",
        "label": "效果强度",
        "min": 0,
        "max": 100,
        "default": 50
      }
    ]
  }
}
```

请帮我设计一套**动态表单渲染系统**：

1. **表单渲染引擎**
   - 如何根据JSON Schema动态渲染表单？
   - 如何支持不同的字段类型（text/number/image_upload/enum/date等）？
   - 如何处理字段依赖（某个字段显示依赖另一个字段的值）？

2. **表单字段组件**
   - 如何设计通用的FormField组件？
   - 如何封装Ant Design的Form.Item？
   - 如何支持自定义字段组件（图片上传、视频上传）？

3. **表单验证**
   - 如何根据JSON Schema自动生成验证规则？
   - 如何支持自定义验证（异步验证、跨字段验证）？
   - 如何统一错误提示格式？

4. **表单提交**
   - 如何统一表单提交逻辑？
   - 如何处理文件上传（图片/视频）？
   - 如何显示提交进度（loading状态、成功/失败提示）？

请给出：
- 动态表单系统的架构设计
- DynamicForm组件代码示例
- 字段类型映射表（JSON Schema type → React组件）
- 表单验证规则生成器代码
```

---

### 问题4：分页列表与数据表格

```
我们的管理后台有大量的数据表格页面：
- 用户管理（分页、筛选、搜索、批量操作）
- 订单管理（分页、筛选、导出）
- 任务监控（分页、实时更新、状态筛选）
- 分销代理（分页、搜索、审核）

当前问题：
1. 每个表格页面都重复写分页逻辑（useState管理page/pageSize/total）
2. 每个表格页面都重复写筛选逻辑（搜索、日期范围、状态筛选）
3. 每个表格页面都重复写数据加载逻辑（loading/error/data状态管理）
4. 代码重复率>80%

请帮我设计一套**通用的表格页面架构**：

1. **自定义Hook**
   - 设计usePagination Hook（管理分页状态）
   - 设计useTableData Hook（管理表格数据加载）
   - 设计useTableFilter Hook（管理筛选条件）

2. **通用表格组件**
   - 如何封装Ant Design的Table组件？
   - 如何支持自定义列配置？
   - 如何支持批量操作（全选、批量删除、批量审核）？

3. **筛选组件**
   - 如何设计通用的FilterBar组件？
   - 如何支持不同的筛选类型（搜索框、日期选择器、下拉选择）？
   - 如何自动生成筛选条件的API参数？

4. **数据刷新**
   - 如何实现自动刷新（轮询）？
   - 如何实现手动刷新？
   - 如何避免重复请求？

请给出：
- usePagination/useTableData/useTableFilter Hook代码
- DataTable通用组件代码示例
- 一个完整的表格页面示例（用户管理）
```

---

### 问题5：权限管理与路由守卫

```
我们的产品有3种角色：
1. 普通用户（只能访问工作台、素材库、个人中心）
2. 分销代理（额外可访问分销中心）
3. 管理员（可访问管理后台）

当前问题：
1. 权限检查散落在每个页面的useEffect中
2. 未登录用户可以访问需要登录的页面（显示空白然后跳转）
3. 普通用户可以访问管理后台URL（报错后才跳转）
4. 缺少统一的权限管理

请帮我设计一套**完整的权限管理方案**：

1. **权限模型**
   - 如何设计权限数据结构（角色、权限、资源）？
   - 如何存储用户权限（Zustand store）？
   - 如何验证用户权限（hasPermission函数）？

2. **路由守卫**
   - 如何在Next.js App Router中实现路由守卫（middleware）？
   - 如何实现未登录跳转登录页？
   - 如何实现权限不足跳转403页面？
   - 如何避免闪烁（先渲染页面再跳转）？

3. **组件级权限**
   - 如何设计<PermissionGuard>组件（包裹需要权限的内容）？
   - 如何实现按钮级权限控制（某些按钮只有管理员可见）？

4. **菜单权限**
   - 如何根据用户权限动态生成导航菜单？
   - 如何隐藏无权限的菜单项？

请给出：
- 权限数据结构设计（TypeScript类型）
- Next.js middleware路由守卫代码
- PermissionGuard组件代码
- 动态菜单生成逻辑
```

---

### 问题6：API请求与错误处理

```
我们的API请求使用axios封装，但存在以下问题：

当前代码：
```typescript
// lib/api.ts
export const api = {
  async get(url: string) {
    const res = await axios.get(url);
    return res.data;
  },
  // ...
};
```

问题：
1. 没有统一的错误处理（每个页面都try-catch）
2. 没有统一的loading状态管理
3. 没有请求重试机制
4. 没有请求缓存
5. 错误提示不友好

请帮我设计一套**工业级的API请求方案**：

1. **请求拦截器**
   - 如何自动添加token到请求头？
   - 如何处理token过期（自动刷新token）？
   - 如何添加请求ID（用于链路追踪）？

2. **响应拦截器**
   - 如何统一处理成功响应（提取data字段）？
   - 如何统一处理错误响应（401/403/500等）？
   - 如何自动显示错误提示（Ant Design message）？

3. **自定义Hook**
   - 设计useRequest Hook（管理loading/error/data状态）
   - 如何支持手动触发请求？
   - 如何支持自动重试？
   - 如何支持请求取消（组件卸载时）？

4. **缓存策略**
   - 如何缓存GET请求（避免重复请求）？
   - 如何设置缓存过期时间？
   - 如何手动清除缓存？

5. **类型安全**
   - 如何实现请求/响应的类型推断？
   - 如何避免any类型？

请给出：
- axios配置与拦截器代码
- useRequest Hook完整代码
- 一个页面使用useRequest的示例
```

---

## 🎯 期望输出

请GPT-5针对以上6个问题，分别给出：

### 1. 完整的架构设计文档
- 目录结构（树形图）
- 每个模块的职责说明
- 数据流图（组件→Hook→API→Store）
- 文件命名规范

### 2. 核心代码示例
- 每个问题至少3个代码示例
- 代码必须是可运行的（不要伪代码）
- 代码必须符合TypeScript严格模式
- 代码必须符合React最佳实践

### 3. 最佳实践建议
- 每个问题的常见坑和注意事项
- 性能优化建议
- 可维护性建议

### 4. 迁移方案
- 如何从现有混乱代码迁移到新架构？
- 迁移步骤（分阶段，不影响线上服务）
- 风险评估

---

## 📌 补充说明

### 技术栈限制
- ✅ 必须用：Next.js 14, Ant Design 5, TypeScript, Zustand
- ❌ 不能用：Redux, MobX, Vue, Angular
- ⚠️  可选用：React Query（如果能解决问题）

### 代码质量要求
- 必须符合SOLID原则
- 必须符合DRY原则（Don't Repeat Yourself）
- 必须符合KISS原则（Keep It Simple, Stupid）
- 代码可读性>90%（清晰的注释、合理的命名）

### 性能要求
- 首屏加载<2秒
- 路由切换<500ms
- 表格渲染1000行<1秒

---

## ✅ 交付检查清单

GPT-5的回答必须包含以下内容：

- [ ] 完整的目录结构设计（树形图）
- [ ] 6个问题的详细解决方案
- [ ] 每个问题至少3个可运行的代码示例
- [ ] TypeScript类型定义完整
- [ ] 最佳实践建议
- [ ] 迁移方案与步骤
- [ ] 常见问题FAQ

---

**艹！把这个问题扔给GPT-5，让它给你设计一套工业级的前端架构！** 🚀
