# ä»»åŠ¡å¡æ¸…å• - æ‰¹é‡å¤„ç†åŠŸèƒ½

> **è¿­ä»£å‘¨æœŸ**: Sprint 2025-W45~W46
> **æ€»å·¥æœŸ**: 8-10ä¸ªå·¥ä½œæ—¥
> **äº§å“ç»ç†**: è€ç‹

---

## ğŸ“‹ ä»»åŠ¡å¡æ€»è§ˆ

| ä»»åŠ¡å¡ç¼–å· | ä»»åŠ¡åç§° | è´Ÿè´£æŠ€èƒ½ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | çŠ¶æ€ |
|-----------|---------|---------|--------|--------|------|
| æ‰¹é‡å¤„ç†-01 | æ•°æ®åº“è¿ç§» | backend_dev_skill | P0 | 0.5å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-02 | æ‰¹é‡ä¸Šä¼ ç»„ä»¶å¼€å‘ | frontend_dev_skill | P0 | 1.5å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-03 | åŠ¨æ€è¡¨å•æ‰©å±• | frontend_dev_skill | P0 | 1å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-04 | æ‰¹é‡ä»»åŠ¡åˆ›å»ºæ¥å£ | backend_dev_skill | P0 | 2å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-05 | æ‰¹é‡ä»»åŠ¡å¤„ç†é€»è¾‘ | backend_dev_skill | P0 | 3å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-06 | æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µ | frontend_dev_skill | P0 | 2å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-07 | æ‰¹é‡ä¸‹è½½ZIPæ¥å£ | backend_dev_skill | P1 | 1.5å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-08 | ä»»åŠ¡åˆ—è¡¨é¡µæ”¹é€  | frontend_dev_skill | P1 | 1å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-09 | é‡è¯•å¤±è´¥é¡¹æ¥å£ | backend_dev_skill | P1 | 1å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-10 | å–æ¶ˆæ‰¹é‡ä»»åŠ¡æ¥å£ | backend_dev_skill | P2 | 1å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-11 | é™æµç­–ç•¥é…ç½® | backend_dev_skill + billing_guard_skill | P0 | 0.5å¤© | å¾…å¼€å§‹ |
| æ‰¹é‡å¤„ç†-12 | QAæµ‹è¯•å’Œä¿®å¤ | qa_acceptance_skill | P0 | 2å¤© | å¾…å¼€å§‹ |

**æ€»è®¡**: 12ä¸ªä»»åŠ¡å¡ï¼ŒP0ä»»åŠ¡7ä¸ªï¼ŒP1ä»»åŠ¡3ä¸ªï¼ŒP2ä»»åŠ¡1ä¸ª

---

## ğŸ¯ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-01ã€‘æ•°æ®åº“è¿ç§»

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P0ï¼ˆæœ€é«˜ï¼‰

**å·¥ä½œé‡**: 0.5å¤©

**å‰ç½®ä¾èµ–**: æ— 

### ä»»åŠ¡æè¿°

æ‰©å±•`tasks`è¡¨ä»¥æ”¯æŒæ‰¹é‡ä»»åŠ¡åŠŸèƒ½ï¼Œæ–°å¢å­—æ®µç”¨äºè®°å½•æ‰¹é‡ä»»åŠ¡çš„å…ƒä¿¡æ¯å’Œå­ä»»åŠ¡åˆ—è¡¨ã€‚

### å…·ä½“å·¥ä½œ

1. åˆ›å»ºè¿ç§»æ–‡ä»¶`backend/src/db/migrations/YYYYMMDDHHMMSS_add_batch_support_to_tasks.js`
2. æ·»åŠ ä»¥ä¸‹å­—æ®µåˆ°`tasks`è¡¨ï¼š
   - `is_batch` BOOLEAN DEFAULT FALSE - æ˜¯å¦ä¸ºæ‰¹é‡ä»»åŠ¡
   - `batch_total` INT DEFAULT 1 - æ‰¹é‡ä»»åŠ¡æ€»æ•°
   - `batch_success` INT DEFAULT 0 - æˆåŠŸæ•°é‡
   - `batch_failed` INT DEFAULT 0 - å¤±è´¥æ•°é‡
   - `batch_items` JSON DEFAULT NULL - æ‰¹é‡å­ä»»åŠ¡åˆ—è¡¨ï¼ˆå­˜å‚¨æ¯å¼ å›¾çš„å¤„ç†çŠ¶æ€ï¼‰
3. æ·»åŠ ç´¢å¼•`CREATE INDEX idx_is_batch ON tasks(is_batch);`
4. è¿è¡Œ`npm run db:migrate:latest`éªŒè¯è¿ç§»

### batch_itemså­—æ®µç»“æ„ç¤ºä¾‹

```json
[
  {
    "index": 0,
    "input_url": "https://cos.../input1.jpg",
    "status": "success",
    "output_url": "https://cos.../output1.jpg",
    "error_message": null
  },
  {
    "index": 1,
    "input_url": "https://cos.../input2.jpg",
    "status": "failed",
    "output_url": null,
    "error_message": "å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ"
  }
]
```

### éªŒæ”¶æ ‡å‡†

- âœ… `npm run db:migrate:latest`æˆåŠŸæ‰§è¡Œï¼Œæ— æŠ¥é”™
- âœ… `tasks`è¡¨åŒ…å«5ä¸ªæ–°å­—æ®µï¼ˆ`is_batch`, `batch_total`, `batch_success`, `batch_failed`, `batch_items`ï¼‰
- âœ… `batch_items`å­—æ®µç±»å‹ä¸ºJSON
- âœ… ç´¢å¼•`idx_is_batch`åˆ›å»ºæˆåŠŸ

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨Knexè¿ç§»å·¥å…·
- ç¡®ä¿å­—æ®µé»˜è®¤å€¼æ­£ç¡®ï¼ˆå‘åå…¼å®¹æ—§æ•°æ®ï¼‰
- JSONå­—æ®µæ”¯æŒMySQL 5.7+æˆ–PostgreSQL

---

## ğŸ¨ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-02ã€‘æ‰¹é‡ä¸Šä¼ ç»„ä»¶å¼€å‘

**è´Ÿè´£æŠ€èƒ½**: frontend_dev_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 1.5å¤©

**å‰ç½®ä¾èµ–**: æ— 

### ä»»åŠ¡æè¿°

å¼€å‘æ‰¹é‡å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ ã€å®æ—¶è¿›åº¦æ˜¾ç¤ºã€å‰ç«¯éªŒè¯å’Œé…é¢é¢„è§ˆã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å»ºç»„ä»¶`frontend/src/components/BatchImageUploader.tsx`
2. åŠŸèƒ½å®ç°ï¼š
   - æ”¯æŒæ‹–æ‹½ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼ˆä½¿ç”¨Ant Design Uploadç»„ä»¶ï¼‰
   - æ¯å¼ å›¾ç‰‡å•ç‹¬æ˜¾ç¤ºä¸Šä¼ è¿›åº¦æ¡
   - å‰ç«¯éªŒè¯ï¼š
     - å›¾ç‰‡æ ¼å¼é™åˆ¶ï¼ˆJPG/PNG/WEBPï¼‰
     - å•å¼ å›¾ç‰‡å¤§å°é™åˆ¶ï¼ˆæœ€å¤§10MBï¼‰
     - æ€»æ•°é‡é™åˆ¶ï¼ˆæœ€å¤š50å¼ ï¼‰
   - æ˜¾ç¤ºå·²ä¸Šä¼ å›¾ç‰‡ç¼©ç•¥å›¾åˆ—è¡¨
   - æ”¯æŒåˆ é™¤å·²ä¸Šä¼ å›¾ç‰‡
   - å®æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºé…é¢æ¶ˆè€—ï¼ˆ"3å¼ å›¾ Ã— 1é…é¢ = 3é…é¢"ï¼‰
3. å¤ç”¨ç°æœ‰COSä¸Šä¼ é€»è¾‘ï¼ˆè°ƒç”¨`api.media.getSTS`ï¼‰
4. çŠ¶æ€ç®¡ç†ï¼š
   - `uploadedImages: string[]` - å·²ä¸Šä¼ å›¾ç‰‡URLåˆ—è¡¨
   - `uploadProgress: Record<string, number>` - æ¯å¼ å›¾çš„ä¸Šä¼ è¿›åº¦

### UIè®¾è®¡å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡ä¸Šä¼ å›¾ç‰‡ï¼ˆæœ€å¤š50å¼ ï¼‰                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”            â”‚
â”‚ â”‚å›¾1 â”‚ â”‚å›¾2 â”‚ â”‚å›¾3 â”‚ â”‚ +  â”‚            â”‚
â”‚ â”‚[X] â”‚ â”‚[X] â”‚ â”‚[X] â”‚ â”‚ä¸Šä¼ â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜            â”‚
â”‚ [åˆ é™¤] [åˆ é™¤] [åˆ é™¤]                     â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š å·²é€‰æ‹©: 3å¼ å›¾ç‰‡                       â”‚
â”‚ ğŸ’° é…é¢æ¶ˆè€—: 3é…é¢ (3å¼  Ã— 1é…é¢/å¼ )       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‹–æ‹½10å¼ JPGå›¾ç‰‡ï¼Œæ˜¾ç¤º10ä¸ªä¸Šä¼ è¿›åº¦æ¡
- âœ… ä¸Šä¼ å®Œæˆåæ˜¾ç¤º10å¼ ç¼©ç•¥å›¾
- âœ… ä¸Šä¼ GIFå›¾ç‰‡ï¼Œæ˜¾ç¤ºçº¢è‰²æç¤º"ä¸æ”¯æŒGIFæ ¼å¼"ï¼Œè‡ªåŠ¨ç§»é™¤
- âœ… ä¸Šä¼ å•å¼ 20MBå›¾ç‰‡ï¼Œæç¤º"å›¾ç‰‡ä¸èƒ½è¶…è¿‡10MB"
- âœ… ä¸Šä¼ 51å¼ å›¾ç‰‡ï¼Œæç¤º"æœ€å¤šæ”¯æŒ50å¼ "ï¼Œè‡ªåŠ¨ä¿ç•™å‰50å¼ 
- âœ… é…é¢æ¶ˆè€—è®¡ç®—å‡†ç¡®ï¼ˆ10å¼ å›¾æ˜¾ç¤º"10é…é¢"ï¼‰
- âœ… ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼Œå›¾ç‰‡ä»åˆ—è¡¨ç§»é™¤ï¼Œé…é¢æ¶ˆè€—æ›´æ–°

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨Ant Design Uploadç»„ä»¶çš„`customRequest`è‡ªå®šä¹‰ä¸Šä¼ 
- å¤ç”¨`ImageUploader.tsx`çš„COSä¸Šä¼ é€»è¾‘
- ä½¿ç”¨`Promise.all`å¹¶å‘ä¸Šä¼ å¤šå¼ å›¾ç‰‡
- å‰ç«¯æ ¡éªŒè¦ä¸¥æ ¼ï¼ˆé˜²æ­¢æ— æ•ˆæ–‡ä»¶æäº¤åˆ°åç«¯ï¼‰

---

## ğŸ”— ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-03ã€‘åŠ¨æ€è¡¨å•æ‰©å±•ï¼ˆå•å¼ /æ‰¹é‡æ¨¡å¼åˆ‡æ¢ï¼‰

**è´Ÿè´£æŠ€èƒ½**: frontend_dev_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 1å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-02

### ä»»åŠ¡æè¿°

æ‰©å±•ç°æœ‰`<DynamicForm>`ç»„ä»¶ï¼Œæ”¯æŒå•å¼ æ¨¡å¼å’Œæ‰¹é‡æ¨¡å¼çš„Tabåˆ‡æ¢ï¼Œæ‰¹é‡æ¨¡å¼ä¸‹é›†æˆæ‰¹é‡ä¸Šä¼ ç»„ä»¶ã€‚

### å…·ä½“å·¥ä½œ

1. ä¿®æ”¹`frontend/src/components/DynamicForm.tsx`ï¼š
   - æ–°å¢`mode`çŠ¶æ€ï¼ˆ`'single' | 'batch'`ï¼‰
   - æ·»åŠ æ¨¡å¼åˆ‡æ¢Tabï¼ˆä½¿ç”¨Ant Design Radio.Groupï¼‰
   - å•å¼ æ¨¡å¼ï¼šæ˜¾ç¤º`<ImageUploadField>`ï¼ˆç°æœ‰é€»è¾‘ï¼‰
   - æ‰¹é‡æ¨¡å¼ï¼šæ˜¾ç¤º`<BatchImageUploader>`ï¼ˆæ–°ç»„ä»¶ï¼‰
2. æäº¤é€»è¾‘æ”¹é€ ï¼š
   - å•å¼ æ¨¡å¼ï¼šè°ƒç”¨`POST /api/tasks`ï¼ˆç°æœ‰æ¥å£ï¼‰
   - æ‰¹é‡æ¨¡å¼ï¼šè°ƒç”¨`POST /api/tasks/batch`ï¼ˆæ–°æ¥å£ï¼‰
3. ç¡®è®¤å¼¹çª—æ”¹é€ ï¼š
   - å•å¼ æ¨¡å¼ï¼šæ˜¾ç¤º"æœ¬æ¬¡æ“ä½œå°†æ¶ˆè€—1é…é¢"
   - æ‰¹é‡æ¨¡å¼ï¼šæ˜¾ç¤º"æœ¬æ¬¡æ“ä½œå°†æ¶ˆè€—10é…é¢ï¼ˆ10å¼ å›¾ Ã— 1é…é¢ï¼‰"
4. æäº¤æŒ‰é’®æ–‡æ¡ˆï¼š
   - å•å¼ æ¨¡å¼ï¼š`ç”Ÿæˆï¼ˆæ¶ˆè€— 1 é…é¢ï¼‰`
   - æ‰¹é‡æ¨¡å¼ï¼š`ç”Ÿæˆï¼ˆæ¶ˆè€— 10 é…é¢ï¼‰`

### éªŒæ”¶æ ‡å‡†

- âœ… Tabåˆ‡æ¢æµç•…ï¼ŒUIåˆ‡æ¢æ­£ç¡®
- âœ… å•å¼ æ¨¡å¼æäº¤ï¼Œè°ƒç”¨`POST /api/tasks`ï¼Œåˆ›å»ºå•å¼ ä»»åŠ¡
- âœ… æ‰¹é‡æ¨¡å¼æäº¤ï¼Œè°ƒç”¨`POST /api/tasks/batch`ï¼Œä¼ é€’`input_images`æ•°ç»„
- âœ… ç¡®è®¤å¼¹çª—æ˜¾ç¤ºå‡†ç¡®é…é¢æ¶ˆè€—ï¼ˆæ‰¹é‡æ¨¡å¼ï¼š"æœ¬æ¬¡å°†æ¶ˆè€—10é…é¢ï¼Œå‰©ä½™90é…é¢"ï¼‰
- âœ… æ‰¹é‡æ¨¡å¼è¡¨å•æ•°æ®æ­£ç¡®ï¼ˆ`input_images` + `input_data`ï¼‰

### æŠ€æœ¯è¦ç‚¹

- Tabåˆ‡æ¢æ—¶æ¸…ç©ºè¡¨å•æ•°æ®ï¼ˆé˜²æ­¢å•å¼ /æ‰¹é‡æ¨¡å¼æ•°æ®æ··æ·†ï¼‰
- æ‰¹é‡æ¨¡å¼ä¸‹ï¼Œ`input_data`åº”ç”¨åˆ°æ‰€æœ‰å›¾ç‰‡ï¼ˆç»Ÿä¸€å‚æ•°ï¼‰
- å‰ç«¯æ ¡éªŒæ‰¹é‡æ¨¡å¼ä¸‹å¿…é¡»è‡³å°‘ä¸Šä¼ 1å¼ å›¾

---

## âš™ï¸ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-04ã€‘æ‰¹é‡ä»»åŠ¡åˆ›å»ºæ¥å£

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 2å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-01

### ä»»åŠ¡æè¿°

å¼€å‘æ‰¹é‡ä»»åŠ¡åˆ›å»ºæ¥å£ï¼Œæ”¯æŒæ¥æ”¶å¤šå¼ å›¾ç‰‡URLï¼Œåœ¨äº‹åŠ¡ä¸­æ‰£é…é¢å¹¶åˆ›å»ºæ‰¹é‡ä»»åŠ¡è®°å½•ã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å¢æ¥å£`POST /api/tasks/batch`
2. æ–°å¢æ§åˆ¶å™¨æ–¹æ³•`backend/src/controllers/task.controller.js -> createBatchTask()`
3. æ–°å¢æœåŠ¡æ–¹æ³•`backend/src/services/task.service.js -> createBatchTask()`
4. æ ¸å¿ƒé€»è¾‘ï¼š
   ```javascript
   async createBatchTask(userId, featureId, inputImages, inputData) {
     // 1. æ ¡éªŒæ‰¹é‡æ•°é‡é™åˆ¶ï¼ˆæœ€å¤š50å¼ ï¼‰
     if (inputImages.length > 50) {
       throw { errorCode: 4001, message: 'æ‰¹é‡å¤„ç†æœ€å¤šæ”¯æŒ50å¼ å›¾ç‰‡' };
     }

     // 2. è·å–åŠŸèƒ½å®šä¹‰
     const feature = await featureService.getFeatureDefinition(featureId);

     // 3. æ£€æŸ¥ç”¨æˆ·æƒé™
     const hasAccess = await featureService.checkUserAccess(userId, feature);
     if (!hasAccess) {
       throw { errorCode: 4003, message: 'æ— æƒä½¿ç”¨è¯¥åŠŸèƒ½' };
     }

     // 4. è®¡ç®—é…é¢æ¶ˆè€—
     const quotaCost = inputImages.length * feature.quota_cost;

     // 5. åœ¨äº‹åŠ¡ä¸­æ‰£é…é¢å¹¶åˆ›å»ºä»»åŠ¡
     return await db.transaction(async (trx) => {
       // æ‰£å‡é…é¢
       await quotaService.deduct(userId, quotaCost, trx);

       // åˆ›å»ºæ‰¹é‡ä»»åŠ¡è®°å½•
       const taskId = nanoid();
       const batchItems = inputImages.map((url, index) => ({
         index,
         input_url: url,
         status: 'pending',
         output_url: null,
         error_message: null
       }));

       await trx('tasks').insert({
         id: taskId,
         userId,
         feature_id: featureId,
         status: 'pending',
         is_batch: true,
         batch_total: inputImages.length,
         batch_success: 0,
         batch_failed: 0,
         batch_items: JSON.stringify(batchItems),
         input_data: JSON.stringify(inputData),
         eligible_for_refund: true,
         refunded: false,
         created_at: new Date(),
         updated_at: new Date(),
         // å…¼å®¹æ€§å­—æ®µ
         type: featureId,
         inputUrl: inputImages[0],
         params: null
       });

       return { taskId, quotaCost, batchTotal: inputImages.length };
     });

     // 6. å¼‚æ­¥æ‰§è¡Œæ‰¹é‡Pipeline
     this.processBatchTask(taskId, featureId, inputImages, inputData)
       .catch(err => logger.error(`æ‰¹é‡ä»»åŠ¡å¼‚æ­¥å¤„ç†å¤±è´¥: ${err.message}`, { taskId }));
   }
   ```

### æ¥å£è§„èŒƒ

**è¯·æ±‚**ï¼š
```json
POST /api/tasks/batch
Authorization: Bearer <token>

{
  "feature_id": "basic_clean",
  "input_images": [
    "https://cos.../input1.jpg",
    "https://cos.../input2.jpg",
    "https://cos.../input3.jpg"
  ],
  "input_data": {
    "brightness": 10,
    "contrast": 5
  }
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "task_id": "batch_abc123",
    "batch_total": 3,
    "quota_cost": 3,
    "created_at": "2025-10-30T10:00:00Z"
  }
}
```

### éªŒæ”¶æ ‡å‡†

- âœ… æäº¤10å¼ å›¾æ‰¹é‡ä»»åŠ¡ï¼Œè¿”å›`task_id`
- âœ… `tasks`è¡¨è®°å½•`is_batch=true, batch_total=10, batch_items`åŒ…å«10ä¸ªå­é¡¹
- âœ… é…é¢ä»100æ‰£å‡åˆ°90
- âœ… æäº¤51å¼ å›¾ï¼Œè¿”å›400é”™è¯¯"æœ€å¤šæ”¯æŒ50å¼ "
- âœ… é…é¢ä¸è¶³æ—¶ï¼Œè¿”å›403é”™è¯¯"é…é¢ä¸è¶³"
- âœ… äº‹åŠ¡å›æ»šæµ‹è¯•ï¼šé…é¢æ‰£å‡å¤±è´¥æ—¶ï¼Œä»»åŠ¡ä¸åˆ›å»º

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨Knexäº‹åŠ¡ç¡®ä¿åŸå­æ€§
- é…é¢æ‰£å‡ä½¿ç”¨`FOR UPDATE`è¡Œé”ï¼ˆå·²æœ‰é€»è¾‘ï¼‰
- å¼‚æ­¥å¤„ç†ä¸é˜»å¡å“åº”
- æ—¥å¿—è®°å½•å®Œæ•´ï¼ˆä»»åŠ¡IDã€ç”¨æˆ·IDã€é…é¢æ¶ˆè€—ï¼‰

---

## ğŸ”„ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-05ã€‘æ‰¹é‡ä»»åŠ¡å¤„ç†é€»è¾‘

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 3å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-04

### ä»»åŠ¡æè¿°

å¼€å‘æ‰¹é‡ä»»åŠ¡åå°å¤„ç†é€»è¾‘ï¼Œå¹¶å‘å¤„ç†å¤šå¼ å›¾ç‰‡ï¼Œå®æ—¶æ›´æ–°å­ä»»åŠ¡çŠ¶æ€ï¼Œç»Ÿè®¡æˆåŠŸ/å¤±è´¥æ•°é‡å¹¶è¿”è¿˜é…é¢ã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å»ºæœåŠ¡`backend/src/services/batchProcessor.service.js`
2. å®‰è£…ä¾èµ–`npm install p-limit`ï¼ˆæ§åˆ¶å¹¶å‘æ•°ï¼‰
3. å®ç°æ ¸å¿ƒæ–¹æ³•ï¼š

```javascript
const pLimit = require('p-limit');

class BatchProcessorService {
  /**
   * å¤„ç†æ‰¹é‡ä»»åŠ¡
   */
  async processBatchTask(taskId, featureId, inputImages, inputData) {
    try {
      // 1. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºprocessing
      await db('tasks').where('id', taskId).update({ status: 'processing' });

      // 2. å¹¶å‘å¤„ç†æ‰€æœ‰å›¾ç‰‡ï¼ˆé™åˆ¶å¹¶å‘æ•°ä¸º5ï¼‰
      const limit = pLimit(5);
      const promises = inputImages.map((url, index) =>
        limit(() => this.processItem(taskId, index, featureId, url, inputData))
      );

      const results = await Promise.all(promises);

      // 3. ç»Ÿè®¡æˆåŠŸ/å¤±è´¥æ•°é‡
      const success = results.filter(r => r.status === 'success').length;
      const failed = results.filter(r => r.status === 'failed').length;

      // 4. æ›´æ–°æ‰¹é‡ä»»åŠ¡çŠ¶æ€
      await this.updateBatchTaskStatus(taskId, success, failed);

      // 5. å¦‚æœæœ‰å¤±è´¥ï¼Œéƒ¨åˆ†è¿”è¿˜é…é¢
      if (failed > 0) {
        await this.refundFailedItems(taskId, failed);
      }

      logger.info(`æ‰¹é‡ä»»åŠ¡å¤„ç†å®Œæˆ taskId=${taskId} success=${success} failed=${failed}`);
    } catch (error) {
      logger.error(`æ‰¹é‡ä»»åŠ¡å¤„ç†å¤±è´¥ taskId=${taskId} error=${error.message}`, { error });
      await db('tasks').where('id', taskId).update({ status: 'failed' });
    }
  }

  /**
   * å¤„ç†å•å¼ å›¾ç‰‡
   */
  async processItem(taskId, index, featureId, inputUrl, inputData) {
    try {
      // è°ƒç”¨Pipelineå¤„ç†å•å¼ å›¾ç‰‡
      const result = await pipelineEngine.executeForBatchItem(
        taskId, index, featureId, inputUrl, inputData
      );

      // æ›´æ–°batch_itemsä¸­è¯¥é¡¹çš„çŠ¶æ€ä¸ºæˆåŠŸ
      await this.updateBatchItem(taskId, index, 'success', result.outputUrl, null);

      return { status: 'success', index, outputUrl: result.outputUrl };
    } catch (error) {
      logger.error(`æ‰¹é‡ä»»åŠ¡å­é¡¹å¤„ç†å¤±è´¥ taskId=${taskId} index=${index} error=${error.message}`);

      // æ›´æ–°batch_itemsä¸­è¯¥é¡¹çš„çŠ¶æ€ä¸ºå¤±è´¥
      await this.updateBatchItem(taskId, index, 'failed', null, error.message);

      return { status: 'failed', index, error: error.message };
    }
  }

  /**
   * æ›´æ–°batch_itemsä¸­å•ä¸ªå­é¡¹çš„çŠ¶æ€
   */
  async updateBatchItem(taskId, index, status, outputUrl, errorMessage) {
    const task = await db('tasks').where('id', taskId).first();
    const batchItems = JSON.parse(task.batch_items);

    batchItems[index] = {
      ...batchItems[index],
      status,
      output_url: outputUrl,
      error_message: errorMessage
    };

    await db('tasks')
      .where('id', taskId)
      .update({
        batch_items: JSON.stringify(batchItems),
        updated_at: new Date()
      });
  }

  /**
   * æ›´æ–°æ‰¹é‡ä»»åŠ¡æ•´ä½“çŠ¶æ€
   */
  async updateBatchTaskStatus(taskId, success, failed) {
    const total = success + failed;

    await db('tasks')
      .where('id', taskId)
      .update({
        status: failed === 0 ? 'success' : 'partial_success',
        batch_success: success,
        batch_failed: failed,
        completed_at: new Date(),
        updated_at: new Date()
      });
  }

  /**
   * è¿”è¿˜å¤±è´¥é¡¹é…é¢
   */
  async refundFailedItems(taskId, failedCount) {
    const task = await db('tasks').where('id', taskId).first();
    const feature = await db('feature_definitions').where('feature_id', task.feature_id).first();
    const quotaToRefund = failedCount * feature.quota_cost;

    const result = await quotaService.refund(
      taskId,
      task.userId,
      quotaToRefund,
      `æ‰¹é‡ä»»åŠ¡éƒ¨åˆ†å¤±è´¥è¿”è¿˜:${failedCount}é¡¹`
    );

    if (result.refunded) {
      logger.info(`æ‰¹é‡ä»»åŠ¡å¤±è´¥é¡¹é…é¢è¿”è¿˜æˆåŠŸ taskId=${taskId} failedCount=${failedCount} refunded=${quotaToRefund}`);
    }
  }
}

module.exports = new BatchProcessorService();
```

4. æ‰©å±•`pipelineEngine.service.js`ï¼Œæ–°å¢`executeForBatchItem()`æ–¹æ³•ï¼ˆå¤ç”¨ç°æœ‰Pipelineé€»è¾‘ï¼‰

### éªŒæ”¶æ ‡å‡†

- âœ… æäº¤10å¼ å›¾æ‰¹é‡ä»»åŠ¡ï¼Œå…¨éƒ¨å¤„ç†æˆåŠŸï¼Œ`batch_success=10, batch_failed=0`
- âœ… æäº¤10å¼ å›¾ï¼Œå…¶ä¸­5å¼ æ ¼å¼é”™è¯¯ï¼Œ`batch_success=5, batch_failed=5`
- âœ… 5å¼ å¤±è´¥å›¾ç‰‡è¿”è¿˜5é…é¢
- âœ… `batch_items` JSONæ­£ç¡®è®°å½•æ¯å¼ å›¾ç‰‡çš„å¤„ç†çŠ¶æ€ï¼ˆstatus/output_url/error_messageï¼‰
- âœ… ä»»åŠ¡çŠ¶æ€æ›´æ–°ä¸º`success`æˆ–`partial_success`
- âœ… å¹¶å‘å¤„ç†æµ‹è¯•ï¼š50å¼ å›¾å¹¶å‘å¤„ç†ï¼Œä¸ä¼šå¯¼è‡´æœåŠ¡å™¨å´©æºƒ

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨`p-limit`é™åˆ¶å¹¶å‘æ•°ä¸º5ï¼ˆé˜²æ­¢æœåŠ¡å™¨è¿‡è½½ï¼‰
- å­ä»»åŠ¡å¤±è´¥ä¸å½±å“å…¶ä»–å­ä»»åŠ¡ï¼ˆPromise.all + catchï¼‰
- é…é¢è¿”è¿˜å¿…é¡»æ£€æŸ¥`refunded`å­—æ®µï¼ˆé˜²æ­¢é‡å¤è¿”è¿˜ï¼‰
- JSONå­—æ®µæ›´æ–°éœ€è¦å®Œæ•´è¯»å–ã€ä¿®æ”¹ã€å†™å›

---

## ğŸ“Š ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-06ã€‘æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µ

**è´Ÿè´£æŠ€èƒ½**: frontend_dev_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 2å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-05

### ä»»åŠ¡æè¿°

å¼€å‘æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µï¼Œå®æ—¶æ˜¾ç¤ºæ‰¹é‡å¤„ç†è¿›åº¦ã€æˆåŠŸ/å¤±è´¥ç»Ÿè®¡ã€å­ä»»åŠ¡åˆ—è¡¨å’Œæ‰¹é‡ä¸‹è½½åŠŸèƒ½ã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å»ºé¡µé¢`frontend/src/app/task/batch/[taskId]/page.tsx`
2. é¡µé¢åŠŸèƒ½ï¼š
   - æ˜¾ç¤ºæ‰¹é‡ä»»åŠ¡æ•´ä½“è¿›åº¦ï¼ˆ"45/50 (90%)"ï¼‰
   - æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥/å¤„ç†ä¸­ç»Ÿè®¡
   - åˆ—è¡¨æ˜¾ç¤ºæ¯å¼ å›¾ç‰‡çš„å¤„ç†çŠ¶æ€ï¼ˆæˆåŠŸâœ… / å¤±è´¥âŒ / å¤„ç†ä¸­â³ï¼‰
   - æ”¯æŒå•ç‹¬ä¸‹è½½æ¯å¼ å›¾ç‰‡
   - æ”¯æŒæ‰¹é‡ä¸‹è½½ZIPï¼ˆè°ƒç”¨`GET /api/tasks/:taskId/download-zip`ï¼‰
   - æ”¯æŒ"é‡è¯•å¤±è´¥é¡¹"æŒ‰é’®ï¼ˆè°ƒç”¨`POST /api/tasks/:taskId/retry-failed`ï¼‰
   - å®æ—¶è½®è¯¢æ›´æ–°è¿›åº¦ï¼ˆæ¯3ç§’è¯·æ±‚ä¸€æ¬¡`GET /api/tasks/:taskId`ï¼‰
3. ä½¿ç”¨Ant Designç»„ä»¶ï¼š
   - Progress - è¿›åº¦æ¡
   - List - å­ä»»åŠ¡åˆ—è¡¨
   - Tag - çŠ¶æ€æ ‡ç­¾ï¼ˆsuccess/failed/processingï¼‰
   - Button - ä¸‹è½½/é‡è¯•æŒ‰é’®

### UIè®¾è®¡å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹é‡ä»»åŠ¡è¯¦æƒ… - æœè£…æ¸…ç†å¢å¼º               â”‚
â”‚                                         â”‚
â”‚ ğŸ“Š å¤„ç†è¿›åº¦: 45/50 (90%)                 â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                         â”‚
â”‚ âœ… æˆåŠŸ: 43å¼   âŒ å¤±è´¥: 2å¼   â³ å¤„ç†ä¸­: 5å¼ â”‚
â”‚                                         â”‚
â”‚ [å…¨éƒ¨ä¸‹è½½ZIP] [åªä¸‹è½½æˆåŠŸ] [é‡è¯•å¤±è´¥é¡¹]   â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ 1. input1.jpg   âœ… æˆåŠŸ          â”‚    â”‚
â”‚ â”‚    [ä¸‹è½½] [é¢„è§ˆ]                  â”‚    â”‚
â”‚ â”‚                                 â”‚    â”‚
â”‚ â”‚ 2. input2.jpg   âœ… æˆåŠŸ          â”‚    â”‚
â”‚ â”‚    [ä¸‹è½½] [é¢„è§ˆ]                  â”‚    â”‚
â”‚ â”‚                                 â”‚    â”‚
â”‚ â”‚ 3. input3.jpg   âŒ å¤±è´¥          â”‚    â”‚
â”‚ â”‚    åŸå› : å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ            â”‚    â”‚
â”‚ â”‚                                 â”‚    â”‚
â”‚ â”‚ 4. input4.jpg   â³ å¤„ç†ä¸­...     â”‚    â”‚
â”‚ â”‚                                 â”‚    â”‚
â”‚ â”‚ ...                             â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰¹é‡ä»»åŠ¡å¤„ç†ä¸­ï¼Œæ˜¾ç¤º"5/10 (50%)"ï¼Œè¿›åº¦æ¡å®æ—¶æ›´æ–°
- âœ… æˆåŠŸå›¾ç‰‡æ˜¾ç¤ºç»¿è‰²âœ…æ ‡ç­¾ï¼Œå¤±è´¥æ˜¾ç¤ºçº¢è‰²âŒæ ‡ç­¾ï¼Œå¤„ç†ä¸­æ˜¾ç¤ºè“è‰²â³æ ‡ç­¾
- âœ… ç‚¹å‡»"ä¸‹è½½"æŒ‰é’®ï¼Œä¸‹è½½å¯¹åº”å›¾ç‰‡
- âœ… ç‚¹å‡»"é¢„è§ˆ"æŒ‰é’®ï¼Œå¼¹çª—é¢„è§ˆå›¾ç‰‡
- âœ… ç‚¹å‡»"å…¨éƒ¨ä¸‹è½½ZIP"ï¼Œä¸‹è½½æ‰“åŒ…æ–‡ä»¶
- âœ… ç‚¹å‡»"åªä¸‹è½½æˆåŠŸ"ï¼Œåªæ‰“åŒ…æˆåŠŸçš„å›¾ç‰‡
- âœ… ç‚¹å‡»"é‡è¯•å¤±è´¥é¡¹"ï¼Œè°ƒç”¨æ¥å£é‡æ–°å¤„ç†å¤±è´¥å›¾ç‰‡
- âœ… è½®è¯¢æ¯3ç§’æ›´æ–°ä¸€æ¬¡è¿›åº¦ï¼ˆå¤„ç†å®Œæˆååœæ­¢è½®è¯¢ï¼‰

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨`useEffect` + `setInterval`å®ç°è½®è¯¢
- å¤„ç†å®Œæˆåï¼ˆstatus=successæˆ–partial_successï¼‰åœæ­¢è½®è¯¢
- ä¸‹è½½ZIPæ—¶æ˜¾ç¤ºLoadingçŠ¶æ€ï¼ˆé˜²æ­¢ç”¨æˆ·é‡å¤ç‚¹å‡»ï¼‰
- é¢„è§ˆå›¾ç‰‡ä½¿ç”¨Ant Design Imageç»„ä»¶

---

## ğŸ“¦ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-07ã€‘æ‰¹é‡ä¸‹è½½ZIPæ¥å£

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P1

**å·¥ä½œé‡**: 1.5å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-05

### ä»»åŠ¡æè¿°

å¼€å‘æ‰¹é‡ä¸‹è½½ZIPæ¥å£ï¼Œå°†æ‰¹é‡ä»»åŠ¡çš„æ‰€æœ‰æˆåŠŸç»“æœæ‰“åŒ…æˆZIPæ–‡ä»¶ä¾›ç”¨æˆ·ä¸‹è½½ã€‚

### å…·ä½“å·¥ä½œ

1. å®‰è£…ä¾èµ–`npm install archiver axios`
2. æ–°å¢æ¥å£`GET /api/tasks/:taskId/download-zip`
3. æ ¸å¿ƒé€»è¾‘ï¼š

```javascript
const archiver = require('archiver');
const axios = require('axios');

async downloadBatchZip(req, res) {
  const { taskId } = req.params;
  const userId = req.user.id;
  const { successOnly = true } = req.query; // é»˜è®¤åªä¸‹è½½æˆåŠŸçš„

  try {
    // 1. æŸ¥è¯¢æ‰¹é‡ä»»åŠ¡
    const task = await db('tasks').where('id', taskId).first();

    // 2. æƒé™æ£€æŸ¥
    if (!task) {
      return res.status(404).json({ error: 'ä»»åŠ¡ä¸å­˜åœ¨' });
    }
    if (task.userId !== userId) {
      return res.status(403).json({ error: 'æ— æƒè®¿é—®è¯¥ä»»åŠ¡' });
    }
    if (!task.is_batch) {
      return res.status(400).json({ error: 'è¯¥ä»»åŠ¡ä¸æ˜¯æ‰¹é‡ä»»åŠ¡' });
    }

    // 3. è·å–è¾“å‡ºURLåˆ—è¡¨
    const batchItems = JSON.parse(task.batch_items);
    const targetItems = successOnly
      ? batchItems.filter(item => item.status === 'success')
      : batchItems;

    if (targetItems.length === 0) {
      return res.status(400).json({ error: 'æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶' });
    }

    // 4. è®¾ç½®å“åº”å¤´
    const zipFilename = `batch_${taskId}.zip`;
    res.setHeader('Content-Type', 'application/zip');
    res.setHeader('Content-Disposition', `attachment; filename="${zipFilename}"`);

    // 5. åˆ›å»ºZIPæµ
    const archive = archiver('zip', { zlib: { level: 9 } });
    archive.pipe(res);

    // 6. ä¸‹è½½æ‰€æœ‰å›¾ç‰‡å¹¶æ·»åŠ åˆ°ZIP
    for (const item of targetItems) {
      try {
        const response = await axios.get(item.output_url, { responseType: 'arraybuffer' });
        const filename = `result_${item.index + 1}.jpg`;
        archive.append(Buffer.from(response.data), { name: filename });
      } catch (error) {
        logger.error(`ä¸‹è½½å›¾ç‰‡å¤±è´¥ url=${item.output_url} error=${error.message}`);
        // è·³è¿‡è¯¥å›¾ç‰‡ï¼Œç»§ç»­æ‰“åŒ…å…¶ä»–å›¾ç‰‡
      }
    }

    // 7. å®Œæˆæ‰“åŒ…
    await archive.finalize();

    logger.info(`æ‰¹é‡ä¸‹è½½ZIPæˆåŠŸ taskId=${taskId} files=${targetItems.length}`);
  } catch (error) {
    logger.error(`æ‰¹é‡ä¸‹è½½ZIPå¤±è´¥ taskId=${taskId} error=${error.message}`, { error });
    if (!res.headersSent) {
      res.status(500).json({ error: 'ä¸‹è½½å¤±è´¥' });
    }
  }
}
```

### æ¥å£è§„èŒƒ

**è¯·æ±‚**ï¼š
```
GET /api/tasks/batch_abc123/download-zip?successOnly=true
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```
Content-Type: application/zip
Content-Disposition: attachment; filename="batch_abc123.zip"

[äºŒè¿›åˆ¶ZIPæ–‡ä»¶]
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰¹é‡ä»»åŠ¡10å¼ å›¾å…¨éƒ¨æˆåŠŸï¼Œä¸‹è½½ZIPåŒ…å«10å¼ å›¾
- âœ… æ‰¹é‡ä»»åŠ¡5å¼ æˆåŠŸ5å¼ å¤±è´¥ï¼Œ`successOnly=true`æ—¶ZIPåªåŒ…å«5å¼ 
- âœ… æ‰¹é‡ä»»åŠ¡5å¼ æˆåŠŸ5å¼ å¤±è´¥ï¼Œ`successOnly=false`æ—¶ZIPåŒ…å«5å¼ ï¼ˆå¤±è´¥çš„ä¸æ‰“åŒ…ï¼‰
- âœ… ZIPæ–‡ä»¶åæ ¼å¼ä¸º`batch_ä»»åŠ¡ID.zip`
- âœ… ZIPå†…æ–‡ä»¶å‘½åä¸º`result_1.jpg`, `result_2.jpg`ç­‰
- âœ… ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡ä¸å½±å“å…¶ä»–å›¾ç‰‡æ‰“åŒ…

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨`archiver`åº“æ‰“åŒ…ZIP
- ä½¿ç”¨æµå¼å“åº”ï¼ˆä¸å ç”¨è¿‡å¤šå†…å­˜ï¼‰
- å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ—¶æ§åˆ¶å¹¶å‘ï¼ˆé˜²æ­¢è¿‡å¤šHTTPè¯·æ±‚ï¼‰
- é”™è¯¯å¤„ç†ï¼šå•å¼ å›¾ç‰‡ä¸‹è½½å¤±è´¥ä¸å½±å“æ•´ä½“æ‰“åŒ…

---

## ğŸ“ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-08ã€‘ä»»åŠ¡åˆ—è¡¨é¡µæ”¹é€ 

**è´Ÿè´£æŠ€èƒ½**: frontend_dev_skill

**ä¼˜å…ˆçº§**: P1

**å·¥ä½œé‡**: 1å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-06

### ä»»åŠ¡æè¿°

æ”¹é€ ä»»åŠ¡åˆ—è¡¨é¡µï¼Œæ”¯æŒæ‰¹é‡ä»»åŠ¡çš„ç‰¹æ®Šå±•ç¤ºï¼ˆæ‰¹é‡è§’æ ‡ã€è¿›åº¦æ˜¾ç¤ºã€å±•å¼€/æ”¶èµ·å­ä»»åŠ¡ï¼‰ã€‚

### å…·ä½“å·¥ä½œ

1. ä¿®æ”¹ä»»åŠ¡åˆ—è¡¨é¡µï¼ˆ`/workspace` æˆ– `/tasks`ï¼‰
2. æ‰¹é‡ä»»åŠ¡å¡ç‰‡ç‰¹æ®Šå¤„ç†ï¼š
   - æ˜¾ç¤º"æ‰¹é‡"è“è‰²è§’æ ‡ï¼ˆBadgeï¼‰
   - æ˜¾ç¤ºæ‰¹é‡è¿›åº¦ï¼ˆ"45/50 (90%)"ï¼‰
   - ç‚¹å‡»å±•å¼€/æ”¶èµ·å­ä»»åŠ¡åˆ—è¡¨ï¼ˆCollapseç»„ä»¶ï¼‰
3. å­ä»»åŠ¡åˆ—è¡¨å±•ç¤ºï¼š
   - æ˜¾ç¤ºæ¯å¼ å›¾ç‰‡çš„ç¼©ç•¥å›¾ï¼ˆæˆåŠŸï¼‰æˆ–é”™è¯¯åŸå› ï¼ˆå¤±è´¥ï¼‰
   - æ”¯æŒå¿«é€Ÿè·³è½¬åˆ°æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µ

### UIè®¾è®¡å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»»åŠ¡åˆ—è¡¨                                 â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ”µ æ‰¹é‡ | æœè£…æ¸…ç†å¢å¼º            â”‚    â”‚
â”‚ â”‚ è¿›åº¦: 45/50 (90%)                â”‚    â”‚
â”‚ â”‚ åˆ›å»ºæ—¶é—´: 2025-10-30 10:00       â”‚    â”‚
â”‚ â”‚ [å±•å¼€è¯¦æƒ…â–¼]                      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ æœè£…æ¸…ç†å¢å¼º                      â”‚    â”‚
â”‚ â”‚ çŠ¶æ€: æˆåŠŸ                        â”‚    â”‚
â”‚ â”‚ åˆ›å»ºæ—¶é—´: 2025-10-29 15:30       â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰¹é‡ä»»åŠ¡æ˜¾ç¤º"æ‰¹é‡"è“è‰²è§’æ ‡
- âœ… æ˜¾ç¤ºè¿›åº¦"45/50 (90%)"
- âœ… ç‚¹å‡»"å±•å¼€è¯¦æƒ…"ï¼Œæ˜¾ç¤ºå­ä»»åŠ¡åˆ—è¡¨ï¼ˆæœ€å¤šæ˜¾ç¤º5ä¸ªï¼Œå¤šçš„æ˜¾ç¤º"æŸ¥çœ‹æ›´å¤š"ï¼‰
- âœ… å­ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤ºç¼©ç•¥å›¾ï¼ˆæˆåŠŸï¼‰æˆ–é”™è¯¯åŸå› ï¼ˆå¤±è´¥ï¼‰
- âœ… ç‚¹å‡»æ‰¹é‡ä»»åŠ¡å¡ç‰‡ï¼Œè·³è½¬åˆ°æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µ

### æŠ€æœ¯è¦ç‚¹

- ä½¿ç”¨Ant Design Badgeç»„ä»¶æ˜¾ç¤ºè§’æ ‡
- ä½¿ç”¨Collapseç»„ä»¶å®ç°å±•å¼€/æ”¶èµ·
- å­ä»»åŠ¡åˆ—è¡¨åªæ˜¾ç¤ºå‰5ä¸ªï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- æ‰¹é‡ä»»åŠ¡å’Œå•å¼ ä»»åŠ¡å…±ç”¨ä¸€ä¸ªåˆ—è¡¨ç»„ä»¶ï¼ˆé€šè¿‡`is_batch`å­—æ®µåŒºåˆ†ï¼‰

---

## ğŸ”„ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-09ã€‘é‡è¯•å¤±è´¥é¡¹æ¥å£

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P1

**å·¥ä½œé‡**: 1å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-05

### ä»»åŠ¡æè¿°

å¼€å‘é‡è¯•å¤±è´¥é¡¹æ¥å£ï¼Œå…è®¸ç”¨æˆ·é‡æ–°å¤„ç†æ‰¹é‡ä»»åŠ¡ä¸­å¤±è´¥çš„å›¾ç‰‡ï¼Œæ‰£å‡å¯¹åº”é…é¢ã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å¢æ¥å£`POST /api/tasks/:taskId/retry-failed`
2. æ ¸å¿ƒé€»è¾‘ï¼š

```javascript
async retryFailedItems(req, res) {
  const { taskId } = req.params;
  const userId = req.user.id;

  try {
    // 1. æŸ¥è¯¢æ‰¹é‡ä»»åŠ¡
    const task = await db('tasks').where('id', taskId).first();

    // 2. æƒé™æ£€æŸ¥
    if (!task || task.userId !== userId) {
      return res.status(403).json({ error: 'æ— æƒè®¿é—®è¯¥ä»»åŠ¡' });
    }
    if (!task.is_batch) {
      return res.status(400).json({ error: 'è¯¥ä»»åŠ¡ä¸æ˜¯æ‰¹é‡ä»»åŠ¡' });
    }

    // 3. è·å–å¤±è´¥çš„å­é¡¹
    const batchItems = JSON.parse(task.batch_items);
    const failedItems = batchItems.filter(item => item.status === 'failed');

    if (failedItems.length === 0) {
      return res.status(400).json({ error: 'æ²¡æœ‰å¤±è´¥çš„å­ä»»åŠ¡éœ€è¦é‡è¯•' });
    }

    // 4. è®¡ç®—éœ€è¦æ‰£å‡çš„é…é¢
    const feature = await db('feature_definitions').where('feature_id', task.feature_id).first();
    const quotaCost = failedItems.length * feature.quota_cost;

    // 5. æ£€æŸ¥é…é¢æ˜¯å¦è¶³å¤Ÿ
    const hasEnough = await quotaService.checkQuota(userId, quotaCost);
    if (!hasEnough) {
      return res.status(403).json({ error: 'é…é¢ä¸è¶³ï¼Œè¯·å……å€¼' });
    }

    // 6. åœ¨äº‹åŠ¡ä¸­æ‰£é…é¢
    await db.transaction(async (trx) => {
      await quotaService.deduct(userId, quotaCost, trx);
    });

    // 7. é‡æ–°å¤„ç†å¤±è´¥é¡¹ï¼ˆå¼‚æ­¥ï¼‰
    this.retryFailedItemsAsync(taskId, failedItems)
      .catch(err => logger.error(`é‡è¯•å¤±è´¥é¡¹å¼‚å¸¸ taskId=${taskId} error=${err.message}`));

    res.json({
      success: true,
      message: `å·²é‡æ–°æäº¤${failedItems.length}ä¸ªå¤±è´¥é¡¹`,
      quota_cost: quotaCost
    });
  } catch (error) {
    logger.error(`é‡è¯•å¤±è´¥é¡¹æ¥å£å¤±è´¥ taskId=${taskId} error=${error.message}`, { error });
    res.status(500).json({ error: 'é‡è¯•å¤±è´¥' });
  }
}

async retryFailedItemsAsync(taskId, failedItems) {
  const task = await db('tasks').where('id', taskId).first();
  const inputData = JSON.parse(task.input_data);

  for (const item of failedItems) {
    try {
      // é‡æ–°å¤„ç†è¯¥é¡¹
      const result = await pipelineEngine.executeForBatchItem(
        taskId, item.index, task.feature_id, item.input_url, inputData
      );

      // æ›´æ–°çŠ¶æ€ä¸ºæˆåŠŸ
      await batchProcessor.updateBatchItem(taskId, item.index, 'success', result.outputUrl, null);

      // æ›´æ–°æˆåŠŸè®¡æ•°
      await db('tasks').where('id', taskId).increment('batch_success', 1);
    } catch (error) {
      logger.error(`é‡è¯•å¤±è´¥é¡¹ä»ç„¶å¤±è´¥ taskId=${taskId} index=${item.index} error=${error.message}`);
      // ä¿æŒå¤±è´¥çŠ¶æ€ï¼Œæ›´æ–°é”™è¯¯ä¿¡æ¯
      await batchProcessor.updateBatchItem(taskId, item.index, 'failed', null, error.message);
    }
  }

  logger.info(`é‡è¯•å¤±è´¥é¡¹å®Œæˆ taskId=${taskId} items=${failedItems.length}`);
}
```

### æ¥å£è§„èŒƒ

**è¯·æ±‚**ï¼š
```json
POST /api/tasks/batch_abc123/retry-failed
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "å·²é‡æ–°æäº¤5ä¸ªå¤±è´¥é¡¹",
  "quota_cost": 5
}
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰¹é‡ä»»åŠ¡5å¼ å¤±è´¥ï¼Œç‚¹å‡»"é‡è¯•å¤±è´¥é¡¹"ï¼Œæ‰£å‡5é…é¢
- âœ… é‡è¯•æˆåŠŸåï¼Œ`batch_success`ä»5æ›´æ–°åˆ°10ï¼ˆå‡è®¾å…¨éƒ¨æˆåŠŸï¼‰
- âœ… é‡è¯•å¤±è´¥åï¼Œ`batch_items`ä¿æŒå¤±è´¥çŠ¶æ€ï¼Œæ›´æ–°é”™è¯¯ä¿¡æ¯
- âœ… é…é¢ä¸è¶³æ—¶ï¼Œè¿”å›403é”™è¯¯"é…é¢ä¸è¶³"
- âœ… æ²¡æœ‰å¤±è´¥é¡¹æ—¶ï¼Œè¿”å›400é”™è¯¯"æ²¡æœ‰å¤±è´¥çš„å­ä»»åŠ¡"

### æŠ€æœ¯è¦ç‚¹

- é‡è¯•å‰æ£€æŸ¥é…é¢æ˜¯å¦è¶³å¤Ÿ
- é‡è¯•æˆåŠŸåæ›´æ–°`batch_success`è®¡æ•°
- é‡è¯•ä»ç„¶å¤±è´¥çš„ä¿æŒå¤±è´¥çŠ¶æ€
- å¼‚æ­¥å¤„ç†ä¸é˜»å¡å“åº”

---

## âŒ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-10ã€‘å–æ¶ˆæ‰¹é‡ä»»åŠ¡æ¥å£

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill

**ä¼˜å…ˆçº§**: P2ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**å·¥ä½œé‡**: 1å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-05

### ä»»åŠ¡æè¿°

å¼€å‘å–æ¶ˆæ‰¹é‡ä»»åŠ¡æ¥å£ï¼Œå…è®¸ç”¨æˆ·åœ¨å¤„ç†è¿‡ç¨‹ä¸­å–æ¶ˆä»»åŠ¡ï¼Œåœæ­¢æœªå¤„ç†çš„å­ä»»åŠ¡å¹¶è¿”è¿˜é…é¢ã€‚

### å…·ä½“å·¥ä½œ

1. æ–°å¢æ¥å£`POST /api/tasks/:taskId/cancel`
2. æ ¸å¿ƒé€»è¾‘ï¼š

```javascript
async cancelBatchTask(req, res) {
  const { taskId } = req.params;
  const userId = req.user.id;

  try {
    // 1. æŸ¥è¯¢æ‰¹é‡ä»»åŠ¡
    const task = await db('tasks').where('id', taskId).first();

    // 2. æƒé™æ£€æŸ¥
    if (!task || task.userId !== userId) {
      return res.status(403).json({ error: 'æ— æƒè®¿é—®è¯¥ä»»åŠ¡' });
    }
    if (!task.is_batch) {
      return res.status(400).json({ error: 'è¯¥ä»»åŠ¡ä¸æ˜¯æ‰¹é‡ä»»åŠ¡' });
    }
    if (task.status !== 'processing') {
      return res.status(400).json({ error: 'ä»»åŠ¡ä¸åœ¨å¤„ç†ä¸­ï¼Œæ— æ³•å–æ¶ˆ' });
    }

    // 3. ç»Ÿè®¡æœªå¤„ç†çš„å­é¡¹
    const batchItems = JSON.parse(task.batch_items);
    const pendingItems = batchItems.filter(item => item.status === 'pending').length;

    // 4. è¿”è¿˜æœªå¤„ç†å­é¡¹çš„é…é¢
    if (pendingItems > 0) {
      const feature = await db('feature_definitions').where('feature_id', task.feature_id).first();
      const refundAmount = pendingItems * feature.quota_cost;

      await quotaService.refund(
        taskId,
        userId,
        refundAmount,
        `æ‰¹é‡ä»»åŠ¡å–æ¶ˆè¿”è¿˜:${pendingItems}é¡¹æœªå¤„ç†`
      );
    }

    // 5. æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºcancelled
    await db('tasks')
      .where('id', taskId)
      .update({
        status: 'cancelled',
        updated_at: new Date(),
        completed_at: new Date()
      });

    res.json({
      success: true,
      message: `ä»»åŠ¡å·²å–æ¶ˆï¼Œè¿”è¿˜${pendingItems}é…é¢`,
      refund_amount: pendingItems
    });
  } catch (error) {
    logger.error(`å–æ¶ˆæ‰¹é‡ä»»åŠ¡å¤±è´¥ taskId=${taskId} error=${error.message}`, { error });
    res.status(500).json({ error: 'å–æ¶ˆå¤±è´¥' });
  }
}
```

### æ¥å£è§„èŒƒ

**è¯·æ±‚**ï¼š
```json
POST /api/tasks/batch_abc123/cancel
Authorization: Bearer <token>
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "ä»»åŠ¡å·²å–æ¶ˆï¼Œè¿”è¿˜45é…é¢",
  "refund_amount": 45
}
```

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰¹é‡ä»»åŠ¡å¤„ç†åˆ°5/50æ—¶ç‚¹å‡»å–æ¶ˆï¼Œè¿”è¿˜45é…é¢
- âœ… å·²å®Œæˆçš„5å¼ å›¾æ­£å¸¸ä¿å­˜åˆ°ç´ æåº“
- âœ… ä»»åŠ¡çŠ¶æ€æ›´æ–°ä¸º`cancelled`
- âœ… éprocessingçŠ¶æ€çš„ä»»åŠ¡æ— æ³•å–æ¶ˆï¼Œè¿”å›400é”™è¯¯

### æŠ€æœ¯è¦ç‚¹

- å–æ¶ˆæ“ä½œä¸å½±å“å·²å®Œæˆçš„å­ä»»åŠ¡
- åªè¿”è¿˜`pending`çŠ¶æ€çš„å­ä»»åŠ¡é…é¢
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿é…é¢è¿”è¿˜çš„åŸå­æ€§

---

## ğŸ›¡ï¸ ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-11ã€‘é™æµç­–ç•¥é…ç½®

**è´Ÿè´£æŠ€èƒ½**: backend_dev_skill + billing_guard_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 0.5å¤©

**å‰ç½®ä¾èµ–**: æ— 

### ä»»åŠ¡æè¿°

é…ç½®æ‰¹é‡å¤„ç†åŠŸèƒ½çš„é™æµç­–ç•¥ï¼Œé˜²æ­¢ç”¨æˆ·æ»¥ç”¨æ‰¹é‡åŠŸèƒ½å¯¼è‡´æœåŠ¡å™¨è¿‡è½½ã€‚

### å…·ä½“å·¥ä½œ

1. ä¿®æ”¹`feature_definitions`è¡¨ä¸­æ‰¹é‡åŠŸèƒ½çš„`rate_limit_policy`å­—æ®µ
2. é…ç½®é™æµè§„åˆ™ï¼š
   ```json
   {
     "max_per_hour": 5,        // æ¯å°æ—¶æœ€å¤š5ä¸ªæ‰¹é‡ä»»åŠ¡
     "max_per_day": 20,        // æ¯å¤©æœ€å¤š20ä¸ªæ‰¹é‡ä»»åŠ¡
     "max_images_per_batch": 50 // å•æ¬¡æ‰¹é‡æœ€å¤š50å¼ 
   }
   ```
3. åœ¨`rateLimiter.middleware.js`ä¸­éªŒè¯æ‰¹é‡é™æµ
4. å‰ç«¯æ˜¾ç¤ºé™æµæç¤ºï¼ˆ"æ‚¨ä»Šå¤©å·²åˆ›å»º20ä¸ªæ‰¹é‡ä»»åŠ¡ï¼Œè¯·æ˜å¤©å†è¯•"ï¼‰

### éªŒæ”¶æ ‡å‡†

- âœ… 1å°æ—¶å†…æäº¤6ä¸ªæ‰¹é‡ä»»åŠ¡ï¼Œç¬¬6ä¸ªè¿”å›429é”™è¯¯"è¯·æ±‚è¿‡äºé¢‘ç¹"
- âœ… 1å¤©å†…æäº¤21ä¸ªæ‰¹é‡ä»»åŠ¡ï¼Œç¬¬21ä¸ªè¿”å›429é”™è¯¯
- âœ… æäº¤51å¼ å›¾æ‰¹é‡ä»»åŠ¡ï¼Œè¿”å›400é”™è¯¯"æœ€å¤šæ”¯æŒ50å¼ "
- âœ… å‰ç«¯æ˜¾ç¤ºé™æµæç¤ºæ–‡æ¡ˆ

### æŠ€æœ¯è¦ç‚¹

- é™æµè§„åˆ™å­˜å‚¨åœ¨`feature_definitions.rate_limit_policy`
- å¤ç”¨ç°æœ‰`rateLimiter.middleware.js`
- æ‰¹é‡ä»»åŠ¡ä¹Ÿè®¡å…¥å•ç”¨æˆ·æ€»ä»»åŠ¡æ•°é™æµ

---

## âœ… ã€ä»»åŠ¡å¡-æ‰¹é‡å¤„ç†-12ã€‘QAæµ‹è¯•å’Œä¿®å¤

**è´Ÿè´£æŠ€èƒ½**: qa_acceptance_skill

**ä¼˜å…ˆçº§**: P0

**å·¥ä½œé‡**: 2å¤©

**å‰ç½®ä¾èµ–**: æ‰¹é‡å¤„ç†-01 ~ 11

### ä»»åŠ¡æè¿°

æ‰§è¡Œå®Œæ•´çš„QAæµ‹è¯•ï¼ŒåŒ…æ‹¬åŠŸèƒ½æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯•å’Œå…¼å®¹æ€§æµ‹è¯•ï¼Œè®°å½•Bugå¹¶ååŠ©å¼€å‘ä¿®å¤ã€‚

### æµ‹è¯•ç”¨ä¾‹æ¸…å•

å‚è€ƒPRDæ–‡æ¡£ç¬¬7èŠ‚"éªŒæ”¶æ ‡å‡†"ï¼ŒåŒ…æ‹¬ï¼š

**åŠŸèƒ½æµ‹è¯•ï¼ˆP0ï¼‰**ï¼š
- [ ] æ‰¹é‡ä¸Šä¼ 10å¼ JPGå›¾ç‰‡ï¼Œæ˜¾ç¤º10å¼ ç¼©ç•¥å›¾
- [ ] ä¸Šä¼ GIFå›¾ç‰‡ï¼Œæ˜¾ç¤ºçº¢è‰²æç¤ºå¹¶è‡ªåŠ¨ç§»é™¤
- [ ] ä¸Šä¼ 51å¼ å›¾ç‰‡ï¼Œæç¤º"æœ€å¤šæ”¯æŒ50å¼ "
- [ ] æäº¤10å¼ å›¾æ‰¹é‡ä»»åŠ¡ï¼Œé…é¢ä»100â†’90
- [ ] é…é¢ä¸è¶³æ—¶ï¼Œæç¤º"é…é¢ä¸è¶³ï¼Œè¿˜éœ€Xé…é¢"
- [ ] æ‰¹é‡ä»»åŠ¡å¤„ç†ä¸­ï¼Œæ˜¾ç¤ºè¿›åº¦"3/10"
- [ ] 10å¼ å›¾ä¸­5å¼ å¤±è´¥ï¼ŒæˆåŠŸ5å¼ ï¼Œè¿”è¿˜5é…é¢
- [ ] æ‰¹é‡ä¸‹è½½ZIPï¼ŒåŒ…å«5å¼ æˆåŠŸå›¾ç‰‡
- [ ] é‡è¯•å¤±è´¥é¡¹ï¼Œæ‰£å‡5é…é¢å¹¶é‡æ–°å¤„ç†

**æ€§èƒ½æµ‹è¯•ï¼ˆP0ï¼‰**ï¼š
- [ ] æ‰¹é‡ä¸Šä¼ 50å¼ å›¾ï¼Œå“åº”æ—¶é—´<5ç§’
- [ ] æ‰¹é‡ä»»åŠ¡åˆ›å»ºæ—¶é—´<2ç§’
- [ ] 50å¼ å›¾æ‰¹é‡å¤„ç†æ€»è€—æ—¶<5åˆ†é’Ÿ
- [ ] ZIPæ‰“åŒ…æ—¶é—´<10ç§’

**å®‰å…¨æµ‹è¯•ï¼ˆP0ï¼‰**ï¼š
- [ ] 10ä¸ªè¯·æ±‚åŒæ—¶æäº¤æ‰¹é‡ä»»åŠ¡ï¼Œé…é¢æ‰£å‡å‡†ç¡®
- [ ] æ‰‹åŠ¨è°ƒç”¨2æ¬¡refundæ¥å£ï¼Œç¬¬äºŒæ¬¡è¿”å›"å·²è¿”è¿˜è¿‡é…é¢"
- [ ] ç”¨æˆ·AæŸ¥è¯¢ç”¨æˆ·Bçš„æ‰¹é‡ä»»åŠ¡ï¼Œè¿”å›403é”™è¯¯
- [ ] ä¸Šä¼ å•å¼ 20MBå›¾ç‰‡ï¼Œå‰ç«¯æ‹¦æˆª"å›¾ç‰‡ä¸èƒ½è¶…è¿‡10MB"

**å…¼å®¹æ€§æµ‹è¯•ï¼ˆP1ï¼‰**ï¼š
- [ ] å•å¼ æ¨¡å¼ä¿æŒå¯ç”¨ï¼Œåˆ‡æ¢åæ­£å¸¸æäº¤
- [ ] å†å²å•å¼ ä»»åŠ¡æ­£å¸¸æ˜¾ç¤º
- [ ] æ‰¹é‡ä»»åŠ¡æˆåŠŸåï¼Œå›¾ç‰‡è‡ªåŠ¨ä¿å­˜åˆ°ç´ æåº“

### éªŒæ”¶æ ‡å‡†

- âœ… æ‰€æœ‰P0æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼ˆ100%ï¼‰
- âœ… è‡³å°‘90% P1æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- âœ… æ— é˜»å¡æ€§Bugï¼ˆP0/P1 Bugå…¨éƒ¨ä¿®å¤ï¼‰
- âœ… å›å½’æµ‹è¯•é€šè¿‡

### å·¥ä½œæµç¨‹

1. **ç¬¬1å¤©**ï¼šæ‰§è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œè®°å½•Bugæ¸…å•
2. **ç¬¬2å¤©**ï¼šååŠ©å¼€å‘ä¿®å¤Bugï¼Œå›å½’æµ‹è¯•éªŒè¯

### Bugæ¨¡æ¿

```markdown
**Bug ID**: BUG-æ‰¹é‡å¤„ç†-001
**ä¼˜å…ˆçº§**: P0
**æ ‡é¢˜**: æ‰¹é‡ä»»åŠ¡é…é¢æ‰£å‡ä¸å‡†ç¡®
**å¤ç°æ­¥éª¤**:
1. å‰©ä½™é…é¢100
2. æäº¤10å¼ å›¾æ‰¹é‡ä»»åŠ¡
3. é…é¢å˜æˆ88ï¼ˆé¢„æœŸåº”è¯¥æ˜¯90ï¼‰
**å®é™…ç»“æœ**: é…é¢å˜æˆ88
**é¢„æœŸç»“æœ**: é…é¢å˜æˆ90
**æˆªå›¾**: [é™„ä»¶]
```

---

## ğŸ“… è¿­ä»£è®¡åˆ’

### ç¬¬1å‘¨ï¼ˆWeek 45ï¼‰

**Day 1-2**ï¼š
- æ‰¹é‡å¤„ç†-01 æ•°æ®åº“è¿ç§»
- æ‰¹é‡å¤„ç†-02 æ‰¹é‡ä¸Šä¼ ç»„ä»¶å¼€å‘
- æ‰¹é‡å¤„ç†-11 é™æµç­–ç•¥é…ç½®

**Day 3-4**ï¼š
- æ‰¹é‡å¤„ç†-03 åŠ¨æ€è¡¨å•æ‰©å±•
- æ‰¹é‡å¤„ç†-04 æ‰¹é‡ä»»åŠ¡åˆ›å»ºæ¥å£

**Day 5**ï¼š
- æ‰¹é‡å¤„ç†-05 æ‰¹é‡ä»»åŠ¡å¤„ç†é€»è¾‘ï¼ˆå¼€å§‹ï¼‰

### ç¬¬2å‘¨ï¼ˆWeek 46ï¼‰

**Day 1-2**ï¼š
- æ‰¹é‡å¤„ç†-05 æ‰¹é‡ä»»åŠ¡å¤„ç†é€»è¾‘ï¼ˆå®Œæˆï¼‰
- æ‰¹é‡å¤„ç†-06 æ‰¹é‡ä»»åŠ¡è¯¦æƒ…é¡µ

**Day 3-4**ï¼š
- æ‰¹é‡å¤„ç†-07 æ‰¹é‡ä¸‹è½½ZIPæ¥å£
- æ‰¹é‡å¤„ç†-08 ä»»åŠ¡åˆ—è¡¨é¡µæ”¹é€ 
- æ‰¹é‡å¤„ç†-09 é‡è¯•å¤±è´¥é¡¹æ¥å£

**Day 5**ï¼š
- æ‰¹é‡å¤„ç†-12 QAæµ‹è¯•å’Œä¿®å¤ï¼ˆå¼€å§‹ï¼‰

### ç¬¬3å‘¨ï¼ˆWeek 47ï¼‰

**Day 1-2**ï¼š
- æ‰¹é‡å¤„ç†-12 QAæµ‹è¯•å’Œä¿®å¤ï¼ˆå®Œæˆï¼‰
- Bugä¿®å¤å’Œå›å½’æµ‹è¯•

**Day 3-5**ï¼š
- å°æµé‡ç°åº¦æµ‹è¯•ï¼ˆ10%ç”¨æˆ·ï¼‰
- ç›‘æ§å’ŒBugä¿®å¤
- å‡†å¤‡å…¨é‡ä¸Šçº¿

---

## ğŸ¯ é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¶é—´ | æ ‡å¿— |
|--------|------|------|
| M1: P0ä»»åŠ¡å¡å®Œæˆ | Week 46 Day 2 | æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ |
| M2: P1ä»»åŠ¡å¡å®Œæˆ | Week 46 Day 4 | ä¼˜åŒ–åŠŸèƒ½å¯ç”¨ |
| M3: QAæµ‹è¯•å®Œæˆ | Week 47 Day 2 | æ‰€æœ‰P0 Bugä¿®å¤ |
| M4: ç°åº¦æµ‹è¯•å®Œæˆ | Week 47 Day 5 | å‡†å¤‡å…¨é‡ä¸Šçº¿ |

---

**Product Planner**: è€ç‹
**æœ€åæ›´æ–°**: 2025-10-30
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
