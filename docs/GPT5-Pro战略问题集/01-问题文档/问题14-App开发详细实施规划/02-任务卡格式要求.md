# 任务卡格式要求和示例

## 任务卡标准格式（JSON Schema）

每个任务卡必须严格遵循以下18个字段的格式：

```json
{
  "taskId": "APP-RN-001",
  "department": "react_native_基础搭建",
  "module": "项目初始化",
  "title": "初始化React Native项目并配置基础环境",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 8,
  "priority": "P0",
  "dependencies": [],
  "needsCoordination": [],
  "description": "创建React Native项目，选择合适的版本，配置基础开发环境",
  "technicalRequirements": [
    "使用React Native 0.72 LTS版本",
    "配置TypeScript支持",
    "集成ESLint和Prettier代码规范",
    "配置环境变量管理（react-native-config）"
  ],
  "acceptanceCriteria": [
    "项目可以在iOS和Android模拟器上成功运行",
    "代码规范检查通过",
    "目录结构清晰，符合最佳实践"
  ],
  "codeLocations": [
    "新建目录：mobile-app/",
    "参考Web端配置：frontend/package.json"
  ],
  "testStrategy": [
    "iOS模拟器启动测试",
    "Android模拟器启动测试",
    "代码规范检查（npm run lint）"
  ],
  "aiPromptSuggestion": "请帮我初始化一个React Native 0.72项目，要求：\n1. 使用TypeScript\n2. 配置ESLint和Prettier（参考Web端frontend/的配置）\n3. 配置环境变量管理（开发/测试/生产环境）\n4. 搭建清晰的目录结构（screens/components/services/utils/stores/navigation/assets）\n5. 验证iOS和Android模拟器都能成功运行"
}
```

---

## 完整任务卡示例（按部门分组）

### 1. React Native基础搭建部门（8个任务卡）

#### APP-RN-001：初始化React Native项目
```json
{
  "taskId": "APP-RN-001",
  "department": "react_native_基础搭建",
  "module": "项目初始化",
  "title": "初始化React Native项目并配置基础环境",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 8,
  "priority": "P0",
  "dependencies": [],
  "needsCoordination": [],
  "description": "创建React Native项目，选择合适的版本（0.72 LTS），配置TypeScript、ESLint、Prettier等基础开发环境。搭建清晰的目录结构，为后续开发打好基础。",
  "technicalRequirements": [
    "使用React Native 0.72 LTS版本（稳定性优先）",
    "配置TypeScript支持（与Web端保持一致）",
    "集成ESLint和Prettier代码规范（复用Web端规则）",
    "配置环境变量管理（react-native-config）",
    "搭建目录结构：screens/components/services/utils/stores/navigation/assets"
  ],
  "acceptanceCriteria": [
    "项目可以在iOS和Android模拟器上成功运行（显示Hello World）",
    "TypeScript编译通过，无类型错误",
    "ESLint和Prettier检查通过",
    "环境变量可以正确读取（开发/测试/生产环境）",
    "目录结构清晰，有完整的README.md说明"
  ],
  "codeLocations": [
    "新建目录：mobile-app/",
    "参考Web端配置：frontend/package.json、frontend/.eslintrc.js、frontend/tsconfig.json"
  ],
  "testStrategy": [
    "手动测试：iOS模拟器启动（iPhone 14）",
    "手动测试：Android模拟器启动（Pixel 5）",
    "自动测试：npm run lint（代码规范检查）",
    "自动测试：npm run tsc（TypeScript类型检查）"
  ],
  "aiPromptSuggestion": "请帮我初始化一个React Native 0.72项目，要求：\n\n1. **创建项目**：\n   ```bash\n   npx react-native init MobileApp --template react-native-template-typescript --version 0.72.0\n   ```\n\n2. **配置ESLint和Prettier**：\n   - 参考Web端的配置文件：frontend/.eslintrc.js和frontend/.prettierrc\n   - 添加必要的依赖：@typescript-eslint/parser、prettier等\n\n3. **配置环境变量**：\n   - 安装react-native-config\n   - 创建.env.development、.env.production文件\n   - 配置API_BASE_URL、COS_BUCKET等环境变量\n\n4. **搭建目录结构**：\n   ```\n   mobile-app/src/\n   ├── screens/      # 页面组件\n   ├── components/   # 通用组件\n   ├── services/     # API调用、业务逻辑\n   ├── utils/        # 工具函数\n   ├── stores/       # Zustand状态管理\n   ├── navigation/   # React Navigation配置\n   └── assets/       # 图片、字体等资源\n   ```\n\n5. **编写README.md**：\n   - 项目简介\n   - 环境要求（Node、Xcode、Android Studio版本）\n   - 安装步骤\n   - 运行命令\n\n6. **验证**：\n   - iOS模拟器启动：cd ios && pod install && cd .. && npm run ios\n   - Android模拟器启动：npm run android\n   - 代码检查：npm run lint"
}
```

#### APP-RN-002：配置iOS开发环境
```json
{
  "taskId": "APP-RN-002",
  "department": "react_native_基础搭建",
  "module": "iOS配置",
  "title": "配置iOS开发环境（Xcode、CocoaPods、证书）",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 6,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": [],
  "description": "配置iOS开发所需的Xcode项目、CocoaPods依赖管理、开发证书、Bundle ID、App图标和启动屏等。",
  "technicalRequirements": [
    "Xcode 14+",
    "CocoaPods 1.12+",
    "配置Bundle ID：com.yourcompany.clothesai",
    "配置App Display Name：服装AI助手",
    "设计和配置App图标（1024x1024）",
    "设计和配置启动屏（LaunchScreen.storyboard）"
  ],
  "acceptanceCriteria": [
    "Xcode项目可以正常打开和编译",
    "CocoaPods依赖安装成功",
    "App图标和启动屏正确显示",
    "Bundle ID已配置，可以在真机上运行"
  ],
  "codeLocations": [
    "mobile-app/ios/MobileApp.xcworkspace",
    "mobile-app/ios/Podfile"
  ],
  "testStrategy": [
    "手动测试：Xcode编译成功",
    "手动测试：真机安装成功",
    "视觉测试：App图标和启动屏正确显示"
  ],
  "aiPromptSuggestion": "请帮我配置iOS开发环境，要求：\n\n1. **配置Bundle ID**：\n   - 打开Xcode项目：mobile-app/ios/MobileApp.xcworkspace\n   - 修改Bundle Identifier为：com.yourcompany.clothesai\n   - 修改Display Name为：服装AI助手\n\n2. **配置CocoaPods**：\n   - 检查Podfile（mobile-app/ios/Podfile）\n   - 运行：cd ios && pod install\n\n3. **设计App图标**：\n   - 使用AI工具生成1024x1024的App图标（主题：服装、AI、智能）\n   - 使用工具生成各尺寸图标：https://appicon.co/\n   - 替换mobile-app/ios/MobileApp/Images.xcassets/AppIcon.appiconset/\n\n4. **配置启动屏**：\n   - 编辑LaunchScreen.storyboard\n   - 添加品牌Logo和Slogan\n   - 设置背景色为品牌色\n\n5. **验证**：\n   - Xcode编译：Command+B\n   - 真机运行（如果有开发者账号）"
}
```

#### APP-RN-003：配置Android开发环境
```json
{
  "taskId": "APP-RN-003",
  "department": "react_native_基础搭建",
  "module": "Android配置",
  "title": "配置Android开发环境（Gradle、签名、图标）",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 6,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": [],
  "description": "配置Android开发所需的Gradle构建配置、应用签名、包名、App图标和启动屏等。",
  "technicalRequirements": [
    "Android Studio 2022.3+",
    "Gradle 7.5+",
    "配置Package Name：com.yourcompany.clothesai",
    "配置App Name：服装AI助手",
    "生成签名密钥（Keystore）",
    "配置App图标（mipmap资源）",
    "配置启动屏（SplashScreen）"
  ],
  "acceptanceCriteria": [
    "Android Studio项目可以正常打开和编译",
    "Gradle构建成功",
    "App图标和启动屏正确显示",
    "签名配置完成，可以生成发布版APK"
  ],
  "codeLocations": [
    "mobile-app/android/app/build.gradle",
    "mobile-app/android/app/src/main/AndroidManifest.xml"
  ],
  "testStrategy": [
    "手动测试：Android Studio编译成功",
    "手动测试：生成APK并安装到真机",
    "视觉测试：App图标和启动屏正确显示"
  ],
  "aiPromptSuggestion": "请帮我配置Android开发环境，要求：\n\n1. **配置Package Name**：\n   - 修改build.gradle：applicationId \"com.yourcompany.clothesai\"\n   - 修改AndroidManifest.xml：android:label=\"服装AI助手\"\n\n2. **配置Gradle**：\n   - 检查build.gradle（minSdkVersion 21、targetSdkVersion 33）\n   - 配置签名：\n     ```gradle\n     signingConfigs {\n       release {\n         storeFile file('release.keystore')\n         storePassword 'your_password'\n         keyAlias 'your_alias'\n         keyPassword 'your_password'\n       }\n     }\n     ```\n\n3. **生成Keystore**：\n   ```bash\n   keytool -genkeypair -v -storetype PKCS12 -keystore release.keystore -alias clothesai -keyalg RSA -keysize 2048 -validity 10000\n   ```\n\n4. **配置App图标**：\n   - 使用工具生成各尺寸图标：https://romannurik.github.io/AndroidAssetStudio/\n   - 替换mobile-app/android/app/src/main/res/mipmap-*/\n\n5. **配置启动屏**：\n   - 安装react-native-splash-screen\n   - 配置启动图片和背景色\n\n6. **验证**：\n   - 编译：cd android && ./gradlew assembleRelease"
}
```

#### APP-RN-005：集成React Navigation导航方案
```json
{
  "taskId": "APP-RN-005",
  "department": "react_native_基础搭建",
  "module": "导航配置",
  "title": "集成React Navigation导航方案（Tab导航 + Stack导航）",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 10,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": [],
  "description": "集成React Navigation v6，设计App的导航结构：底部Tab导航（首页、衣柜、我的）+ Stack页面导航（详情页、设置页等）。",
  "technicalRequirements": [
    "安装@react-navigation/native、@react-navigation/bottom-tabs、@react-navigation/native-stack",
    "设计导航结构：Tab导航（3个主页面）+ Stack导航（子页面）",
    "配置深色模式支持",
    "配置导航守卫（未登录跳转登录页）"
  ],
  "acceptanceCriteria": [
    "底部Tab导航正常工作（首页、衣柜、我的）",
    "页面跳转流畅无卡顿",
    "未登录用户自动跳转登录页",
    "深色模式下导航栏样式正确"
  ],
  "codeLocations": [
    "新建：mobile-app/src/navigation/RootNavigator.tsx",
    "新建：mobile-app/src/navigation/TabNavigator.tsx",
    "新建：mobile-app/src/navigation/AuthNavigator.tsx"
  ],
  "testStrategy": [
    "手动测试：点击Tab切换页面",
    "手动测试：页面跳转和返回",
    "手动测试：未登录跳转登录页",
    "性能测试：导航动画流畅度（60fps）"
  ],
  "aiPromptSuggestion": "请帮我集成React Navigation v6，设计以下导航结构：\n\n1. **安装依赖**：\n   ```bash\n   npm install @react-navigation/native @react-navigation/bottom-tabs @react-navigation/native-stack\n   npm install react-native-screens react-native-safe-area-context\n   ```\n\n2. **设计导航结构**：\n   ```\n   RootNavigator（总导航）\n   ├── AuthNavigator（未登录）\n   │   ├── LoginScreen（登录页）\n   │   └── RegisterScreen（注册页）\n   └── MainNavigator（已登录）\n       └── TabNavigator（底部Tab）\n           ├── HomeStack（首页栈）\n           │   ├── HomeScreen（首页）\n           │   ├── AIFunctionScreen（AI功能页）\n           │   └── ResultScreen（结果页）\n           ├── ClosetStack（衣柜栈）\n           │   ├── ClosetScreen（衣柜首页）\n           │   ├── ClothDetailScreen（衣物详情）\n           │   └── OutfitScreen（搭配页）\n           └── ProfileStack（我的栈）\n               ├── ProfileScreen（个人中心）\n               ├── MemberScreen（会员中心）\n               └── SettingsScreen（设置）\n   ```\n\n3. **创建导航文件**：\n   - RootNavigator.tsx：根导航，判断登录状态\n   - TabNavigator.tsx：底部Tab导航\n   - 各个Stack导航文件\n\n4. **配置导航守卫**：\n   - 使用Zustand全局状态存储登录状态\n   - 未登录自动跳转登录页\n\n5. **配置深色模式**：\n   - 使用useColorScheme() hook\n   - 配置Light和Dark主题\n\n参考：https://reactnavigation.org/docs/getting-started"
}
```

#### APP-RN-006：集成Zustand状态管理
```json
{
  "taskId": "APP-RN-006",
  "department": "react_native_基础搭建",
  "module": "状态管理",
  "title": "集成Zustand状态管理（与Web端保持一致）",
  "phase": "Phase 1 - Week 1",
  "estimatedHours": 8,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": ["frontend_dev（Web端）"],
  "description": "集成Zustand状态管理库，创建全局状态Store（用户状态、会员状态、衣柜数据等），与Web端保持一致的状态管理方式。",
  "technicalRequirements": [
    "安装zustand、immer、persist（本地持久化）",
    "创建全局Store：authStore（用户状态）、memberStore（会员状态）、closetStore（衣柜数据）",
    "配置AsyncStorage持久化（登录状态、衣柜数据）",
    "参考Web端的Store设计（frontend/src/stores/）"
  ],
  "acceptanceCriteria": [
    "全局状态可以正常读写",
    "登录状态持久化（重启App仍然保持登录）",
    "衣柜数据持久化（本地缓存）",
    "状态更新后组件自动重新渲染"
  ],
  "codeLocations": [
    "新建：mobile-app/src/stores/authStore.ts",
    "新建：mobile-app/src/stores/memberStore.ts",
    "新建：mobile-app/src/stores/closetStore.ts",
    "参考：frontend/src/stores/（Web端Store）"
  ],
  "testStrategy": [
    "单元测试：Store的CRUD操作",
    "集成测试：登录后状态持久化",
    "手动测试：重启App后仍然保持登录"
  ],
  "aiPromptSuggestion": "请帮我集成Zustand状态管理，参考Web端的实现：\n\n1. **安装依赖**：\n   ```bash\n   npm install zustand immer @react-native-async-storage/async-storage\n   ```\n\n2. **创建authStore**（用户状态）：\n   - 参考：frontend/src/stores/authStore.ts\n   - 状态：user、token、isLoggedIn\n   - 方法：login、logout、updateUser\n   - 持久化：token和user信息\n\n3. **创建memberStore**（会员状态）：\n   - 参考：frontend/src/stores/memberStore.ts（如果有）\n   - 状态：memberInfo、quotaBalance\n   - 方法：fetchMemberInfo、refreshQuota\n\n4. **创建closetStore**（衣柜数据）：\n   - 状态：clothes（衣物列表）、outfits（搭配列表）\n   - 方法：addCloth、removeCloth、updateCloth、syncToCloud\n   - 持久化：本地SQLite + AsyncStorage\n\n5. **配置持久化**：\n   ```typescript\n   import { create } from 'zustand';\n   import { persist, createJSONStorage } from 'zustand/middleware';\n   import AsyncStorage from '@react-native-async-storage/async-storage';\n\n   export const useAuthStore = create(\n     persist(\n       (set) => ({\n         user: null,\n         token: null,\n         login: (user, token) => set({ user, token }),\n         logout: () => set({ user: null, token: null }),\n       }),\n       {\n         name: 'auth-storage',\n         storage: createJSONStorage(() => AsyncStorage),\n       }\n     )\n   );\n   ```\n\n6. **验证**：\n   - 登录后重启App，仍然保持登录状态"
}
```

---

### 2. 用户认证模块部门（6个任务卡）

#### APP-AUTH-001：实现登录页面UI
```json
{
  "taskId": "APP-AUTH-001",
  "department": "用户认证模块",
  "module": "登录注册",
  "title": "实现登录页面UI（手机号+验证码）",
  "phase": "Phase 1 - Week 2",
  "estimatedHours": 8,
  "priority": "P0",
  "dependencies": ["APP-RN-005", "APP-RN-006"],
  "needsCoordination": ["backend_dev（验证码API）"],
  "description": "设计和实现登录页面，支持手机号+验证码登录（主推方式），UI风格与Web端保持一致，提供良好的用户体验。",
  "technicalRequirements": [
    "使用React Native基础组件（TextInput、TouchableOpacity、View）",
    "手机号输入框（带格式校验）",
    "验证码输入框（6位数字）",
    "发送验证码按钮（60秒倒计时）",
    "登录按钮（loading状态）",
    "微信登录按钮（跳转微信授权）",
    "Apple登录按钮（iOS必须，跳转Apple授权）",
    "用户协议和隐私政策链接"
  ],
  "acceptanceCriteria": [
    "登录页面UI美观，符合品牌风格",
    "手机号格式校验正确（11位数字）",
    "验证码倒计时正常工作",
    "登录按钮有loading状态",
    "错误提示友好（手机号格式错误、验证码错误等）"
  ],
  "codeLocations": [
    "新建：mobile-app/src/screens/auth/LoginScreen.tsx",
    "新建：mobile-app/src/components/auth/PhoneInput.tsx",
    "新建：mobile-app/src/components/auth/CodeInput.tsx",
    "参考：frontend/src/pages/auth/login.tsx（Web端登录页）"
  ],
  "testStrategy": [
    "手动测试：输入各种格式的手机号（正确、错误）",
    "手动测试：发送验证码（倒计时、重复发送）",
    "手动测试：登录（成功、失败、网络错误）",
    "视觉测试：UI还原度（对比设计稿）"
  ],
  "aiPromptSuggestion": "请帮我实现登录页面UI，要求：\n\n1. **创建LoginScreen组件**：\n   - 位置：mobile-app/src/screens/auth/LoginScreen.tsx\n   - 参考Web端：frontend/src/pages/auth/login.tsx\n\n2. **页面结构**：\n   - 顶部：Logo + Slogan\n   - 中部：手机号输入框 + 验证码输入框 + 登录按钮\n   - 底部：微信登录 + Apple登录 + 用户协议链接\n\n3. **手机号输入框**：\n   - 使用TextInput组件\n   - keyboardType=\"phone-pad\"\n   - maxLength=11\n   - 实时校验格式（/^1[3-9]\\d{9}$/）\n\n4. **验证码输入框**：\n   - 使用TextInput组件\n   - keyboardType=\"number-pad\"\n   - maxLength=6\n   - 右侧：发送验证码按钮（60秒倒计时）\n\n5. **登录按钮**：\n   - 使用TouchableOpacity组件\n   - 显示loading状态（ActivityIndicator）\n   - 禁用状态（手机号或验证码为空时）\n\n6. **第三方登录按钮**：\n   - 微信登录：图标 + \"微信登录\"\n   - Apple登录（仅iOS）：图标 + \"Apple登录\"\n\n7. **样式**：\n   - 参考Web端的设计风格\n   - 使用品牌色（主色、辅色）\n   - 响应式布局（适配不同屏幕尺寸）\n\n8. **表单校验**：\n   - 手机号格式校验\n   - 验证码非空校验\n   - 错误提示（Toast或Alert）"
}
```

---

### 3. 服装AI功能模块部门（12个任务卡）

#### APP-AI-001：实现拍照/选图功能
```json
{
  "taskId": "APP-AI-001",
  "department": "服装AI功能模块",
  "module": "图片处理",
  "title": "实现拍照/选图功能（react-native-image-picker）",
  "phase": "Phase 2 - Week 3",
  "estimatedHours": 6,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": [],
  "description": "集成react-native-image-picker，实现拍照和从相册选择图片的功能，支持图片压缩和权限请求。",
  "technicalRequirements": [
    "安装react-native-image-picker",
    "配置iOS权限（NSCameraUsageDescription、NSPhotoLibraryUsageDescription）",
    "配置Android权限（CAMERA、READ_EXTERNAL_STORAGE）",
    "支持拍照（launchCamera）",
    "支持选图（launchImageLibrary）",
    "图片压缩（maxWidth: 1920, maxHeight: 1920, quality: 0.8）",
    "错误处理（权限拒绝、取消选择）"
  ],
  "acceptanceCriteria": [
    "拍照功能正常工作（前置/后置摄像头）",
    "选图功能正常工作（单选/多选）",
    "图片自动压缩（大小控制在2MB以内）",
    "权限请求友好（引导用户开启权限）",
    "错误处理完善（权限拒绝、取消选择、存储空间不足）"
  ],
  "codeLocations": [
    "新建：mobile-app/src/utils/imagePicker.ts",
    "配置：mobile-app/ios/MobileApp/Info.plist",
    "配置：mobile-app/android/app/src/main/AndroidManifest.xml"
  ],
  "testStrategy": [
    "手动测试：拍照（前置/后置摄像头）",
    "手动测试：选图（单选/多选）",
    "手动测试：权限请求（首次使用、权限拒绝后再次请求）",
    "性能测试：大图片压缩速度"
  ],
  "aiPromptSuggestion": "请帮我实现拍照/选图功能，要求：\n\n1. **安装依赖**：\n   ```bash\n   npm install react-native-image-picker\n   cd ios && pod install\n   ```\n\n2. **配置iOS权限**（Info.plist）：\n   ```xml\n   <key>NSCameraUsageDescription</key>\n   <string>需要使用相机拍摄服装照片</string>\n   <key>NSPhotoLibraryUsageDescription</key>\n   <string>需要访问相册选择服装照片</string>\n   ```\n\n3. **配置Android权限**（AndroidManifest.xml）：\n   ```xml\n   <uses-permission android:name=\"android.permission.CAMERA\" />\n   <uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" />\n   ```\n\n4. **创建imagePicker工具**：\n   ```typescript\n   import { launchCamera, launchImageLibrary } from 'react-native-image-picker';\n\n   export const pickImageFromCamera = async () => {\n     const result = await launchCamera({\n       mediaType: 'photo',\n       maxWidth: 1920,\n       maxHeight: 1920,\n       quality: 0.8,\n     });\n     if (result.didCancel) return null;\n     if (result.errorCode) throw new Error(result.errorMessage);\n     return result.assets[0];\n   };\n\n   export const pickImageFromLibrary = async (multiple = false) => {\n     const result = await launchImageLibrary({\n       mediaType: 'photo',\n       selectionLimit: multiple ? 10 : 1,\n       maxWidth: 1920,\n       maxHeight: 1920,\n       quality: 0.8,\n     });\n     if (result.didCancel) return null;\n     if (result.errorCode) throw new Error(result.errorMessage);\n     return multiple ? result.assets : result.assets[0];\n   };\n   ```\n\n5. **错误处理**：\n   - 权限拒绝：引导用户去设置页面开启权限\n   - 取消选择：返回null，不报错\n   - 存储空间不足：提示用户清理空间\n\n6. **验证**：\n   - 拍照后查看压缩后的文件大小\n   - 选图后查看图片质量"
}
```

#### APP-AI-003：实现智能抠图功能页面
```json
{
  "taskId": "APP-AI-003",
  "department": "服装AI功能模块",
  "module": "智能抠图",
  "title": "实现智能抠图功能页面（拍照 → 上传 → 结果）",
  "phase": "Phase 2 - Week 3",
  "estimatedHours": 12,
  "priority": "P0",
  "dependencies": ["APP-AI-001", "APP-AI-002", "APP-RN-007"],
  "needsCoordination": ["backend_dev（抠图API）"],
  "description": "实现智能抠图功能的完整页面流程：拍照/选图 → 图片预览 → 上传COS → 调用后端API → 显示处理进度 → 展示结果 → 下载/分享。",
  "technicalRequirements": [
    "复用拍照/选图工具（APP-AI-001）",
    "上传图片到COS（临时凭证 + 直传）",
    "调用后端API：POST /api/tasks/create（feature_id: 'background_removal'）",
    "WebSocket实时显示处理进度（连接wss://...）",
    "展示抠图结果（对比原图和结果图）",
    "下载结果到相册（react-native-fs）",
    "分享结果（react-native-share）"
  ],
  "acceptanceCriteria": [
    "用户可以拍照或选图",
    "图片上传到COS成功（显示上传进度）",
    "任务创建成功（返回taskId）",
    "实时显示处理进度（0% → 100%）",
    "抠图结果正确展示（透明背景PNG）",
    "用户可以下载结果到相册",
    "用户可以分享结果到微信等"
  ],
  "codeLocations": [
    "新建：mobile-app/src/screens/ai/BackgroundRemovalScreen.tsx",
    "新建：mobile-app/src/services/cosUpload.ts",
    "新建：mobile-app/src/services/taskApi.ts",
    "参考：frontend/src/pages/ai/background-removal.tsx（Web端抠图页）"
  ],
  "testStrategy": [
    "手动测试：完整流程（拍照 → 上传 → 处理 → 结果）",
    "手动测试：各种错误场景（网络错误、上传失败、处理失败）",
    "性能测试：上传速度、处理速度",
    "兼容性测试：不同尺寸的图片"
  ],
  "aiPromptSuggestion": "请帮我实现智能抠图功能页面，参考Web端的实现：\n\n1. **页面结构**：\n   - 顶部：标题 + 返回按钮\n   - 中部：图片预览区（原图 vs 结果图对比）\n   - 底部：操作按钮（拍照、选图、下载、分享）\n\n2. **流程设计**：\n   ```\n   Step 1: 用户拍照/选图\n   Step 2: 显示图片预览，用户确认\n   Step 3: 上传图片到COS（显示上传进度）\n   Step 4: 调用后端API创建任务\n   Step 5: WebSocket监听任务进度（0% → 100%）\n   Step 6: 任务完成，显示抠图结果\n   Step 7: 用户下载/分享结果\n   ```\n\n3. **COS直传实现**：\n   - 调用后端API获取临时凭证：GET /api/cos/credentials\n   - 使用cos-js-sdk-v5上传图片到COS\n   - 返回COS URL\n\n4. **创建任务**：\n   ```typescript\n   const createTask = async (imageUrl: string) => {\n     const response = await axios.post('/api/tasks/create', {\n       feature_id: 'background_removal',\n       input_data: {\n         input_image_url: imageUrl,\n       },\n     });\n     return response.data.taskId;\n   };\n   ```\n\n5. **WebSocket监听进度**：\n   ```typescript\n   const ws = new WebSocket('wss://your-domain.com/ws');\n   ws.on('message', (data) => {\n     const { taskId, status, progress, result } = JSON.parse(data);\n     if (taskId === currentTaskId) {\n       setProgress(progress);\n       if (status === 'completed') {\n         setResultUrl(result.output_image_url);\n       }\n     }\n   });\n   ```\n\n6. **展示结果**：\n   - 使用左右滑动对比原图和结果图\n   - 支持缩放查看细节\n\n7. **下载/分享**：\n   - 下载：使用react-native-fs保存到相册\n   - 分享：使用react-native-share分享到微信等\n\n参考Web端：frontend/src/pages/ai/background-removal.tsx"
}
```

---

### 4. 智能衣柜模块部门（15个任务卡）

#### APP-CLOSET-001：实现衣柜首页
```json
{
  "taskId": "APP-CLOSET-001",
  "department": "智能衣柜模块",
  "module": "衣柜首页",
  "title": "实现衣柜首页（统计、分类导航）",
  "phase": "Phase 3 - Week 5",
  "estimatedHours": 10,
  "priority": "P0",
  "dependencies": ["APP-CLOSET-012"],
  "needsCoordination": [],
  "description": "实现智能衣柜首页，展示衣柜统计数据（总件数、各类别占比）、快捷分类导航（上衣、裤子、裙子等）、最近添加的衣物、搭配推荐入口。",
  "technicalRequirements": [
    "从SQLite查询衣柜统计数据",
    "展示衣柜总件数",
    "展示各类别占比（饼图或柱状图）",
    "分类导航（18个大类：上衣、裤子、裙子、外套等）",
    "展示最近添加的衣物（最新6件）",
    "搭配推荐入口（今日推荐、场合推荐）",
    "添加衣物按钮（浮动按钮，右下角）"
  ],
  "acceptanceCriteria": [
    "衣柜统计数据正确显示",
    "分类导航点击可以跳转到对应分类页面",
    "最近添加的衣物正确展示（图片 + 名称）",
    "添加衣物按钮点击跳转到添加页面",
    "页面加载速度快（<1秒）"
  ],
  "codeLocations": [
    "新建：mobile-app/src/screens/closet/ClosetHomeScreen.tsx",
    "新建：mobile-app/src/components/closet/StatisticsCard.tsx",
    "新建：mobile-app/src/components/closet/CategoryGrid.tsx",
    "新建：mobile-app/src/services/closetDatabase.ts"
  ],
  "testStrategy": [
    "手动测试：衣柜首页数据展示",
    "手动测试：分类导航跳转",
    "手动测试：添加衣物按钮点击",
    "性能测试：页面加载速度"
  ],
  "aiPromptSuggestion": "请帮我实现衣柜首页，要求：\n\n1. **页面结构**：\n   - 顶部：标题 + 统计卡片\n   - 中上：分类导航（Grid布局，4列）\n   - 中下：最近添加（横向滚动列表）\n   - 底部：搭配推荐入口\n   - 浮动按钮：添加衣物（右下角）\n\n2. **统计卡片**：\n   - 显示衣柜总件数\n   - 显示各类别占比（饼图，使用react-native-chart-kit）\n   - 数据来源：SQLite查询\n\n3. **分类导航**：\n   - 18个大类图标（上衣、裤子、裙子、外套、鞋子等）\n   - 点击跳转到对应分类页面\n   - 使用Grid布局（4列）\n\n4. **最近添加**：\n   - 横向滚动列表（FlatList horizontal）\n   - 显示最新6件衣物\n   - 每个卡片：图片 + 名称 + 添加时间\n\n5. **搭配推荐入口**：\n   - 2个卡片：今日推荐、场合推荐\n   - 点击跳转到推荐页面\n\n6. **添加衣物按钮**：\n   - 浮动按钮（FloatingActionButton）\n   - 位置：右下角\n   - 点击跳转到添加衣物页面\n\n7. **SQLite查询**：\n   ```typescript\n   const getClosetStats = async () => {\n     const total = await db.executeSql('SELECT COUNT(*) FROM clothes');\n     const byCategory = await db.executeSql(\n       'SELECT category, COUNT(*) as count FROM clothes GROUP BY category'\n     );\n     return { total, byCategory };\n   };\n   ```\n\n参考问题9的智能衣柜系统设计。"
}
```

#### APP-CLOSET-002：实现添加衣物页面
```json
{
  "taskId": "APP-CLOSET-002",
  "department": "智能衣柜模块",
  "module": "衣物管理",
  "title": "实现添加衣物页面（拍照 → AI识别 → 编辑信息）",
  "phase": "Phase 3 - Week 5",
  "estimatedHours": 14,
  "priority": "P0",
  "dependencies": ["APP-AI-001", "APP-CLOSET-012"],
  "needsCoordination": ["backend_dev（服装识别API）"],
  "description": "实现添加衣物页面，支持拍照或选图，AI自动识别服装分类（18个大类）、颜色、风格，用户可以手动编辑信息，最后保存到本地SQLite和云端。",
  "technicalRequirements": [
    "复用拍照/选图工具（APP-AI-001）",
    "上传图片到COS",
    "调用后端AI识别API（识别分类、颜色、风格）",
    "展示AI识别结果（可编辑）",
    "用户手动编辑：品牌、购买时间、价格、标签、备注",
    "保存到SQLite本地数据库",
    "上传到云端（异步同步）"
  ],
  "acceptanceCriteria": [
    "用户可以拍照或选图",
    "AI自动识别服装分类、颜色、风格（准确率>80%）",
    "用户可以手动修改AI识别结果",
    "用户可以填写品牌、购买时间等信息",
    "衣物成功保存到本地和云端",
    "保存后返回衣柜首页，可以看到新添加的衣物"
  ],
  "codeLocations": [
    "新建：mobile-app/src/screens/closet/AddClothScreen.tsx",
    "新建：mobile-app/src/components/closet/ClothForm.tsx",
    "新建：mobile-app/src/services/clothRecognition.ts",
    "参考：问题9（智能衣柜系统设计）"
  ],
  "testStrategy": [
    "手动测试：拍照添加（各种服装类型）",
    "手动测试：AI识别准确率",
    "手动测试：手动编辑信息",
    "手动测试：保存后查看（本地 + 云端）"
  ],
  "aiPromptSuggestion": "请帮我实现添加衣物页面，要求：\n\n1. **页面流程**：\n   ```\n   Step 1: 用户拍照/选图\n   Step 2: 上传图片到COS\n   Step 3: 调用AI识别API（识别分类、颜色、风格）\n   Step 4: 展示AI识别结果（用户可编辑）\n   Step 5: 用户填写品牌、购买时间、价格等\n   Step 6: 保存到本地SQLite\n   Step 7: 上传到云端（异步）\n   Step 8: 返回衣柜首页\n   ```\n\n2. **AI识别API**：\n   ```typescript\n   const recognizeCloth = async (imageUrl: string) => {\n     const response = await axios.post('/api/ai/cloth-recognition', {\n       image_url: imageUrl,\n     });\n     return {\n       category: response.data.category, // 18个大类之一\n       color: response.data.color,       // 主色调\n       style: response.data.style,       // 休闲/正式/运动等\n     };\n   };\n   ```\n\n3. **表单字段**：\n   - **自动识别**：分类、颜色、风格（可编辑）\n   - **用户填写**：品牌、购买时间、价格、标签、备注\n\n4. **保存到SQLite**：\n   ```sql\n   INSERT INTO clothes (\n     image_url, category, color, style, brand,\n     purchase_date, price, tags, note, created_at\n   ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n   ```\n\n5. **云端同步**：\n   ```typescript\n   const syncToCloud = async (cloth: Cloth) => {\n     await axios.post('/api/closet/clothes', cloth);\n   };\n   ```\n\n6. **UI设计**：\n   - 顶部：图片预览（大图）\n   - 中部：AI识别结果（分类、颜色、风格，带\"AI识别\"标签）\n   - 下部：用户填写表单\n   - 底部：保存按钮\n\n参考问题9的服装识别分类设计（18个大类）。"
}
```

#### APP-CLOSET-012：实现SQLite本地数据库
```json
{
  "taskId": "APP-CLOSET-012",
  "department": "智能衣柜模块",
  "module": "数据存储",
  "title": "实现SQLite本地数据库（衣物表、搭配表、记录表）",
  "phase": "Phase 3 - Week 5",
  "estimatedHours": 10,
  "priority": "P0",
  "dependencies": ["APP-RN-001"],
  "needsCoordination": [],
  "description": "使用react-native-sqlite-storage创建本地SQLite数据库，设计衣物表、搭配表、穿搭记录表的schema，实现CRUD操作，支持离线使用。",
  "technicalRequirements": [
    "安装react-native-sqlite-storage",
    "创建数据库：closet.db",
    "设计表结构：",
    "  - clothes（衣物表）：id、image_url、category、color、style、brand、price、tags、created_at等",
    "  - outfits（搭配表）：id、name、clothes_ids（JSON）、occasion、created_at等",
    "  - records（穿搭记录表）：id、outfit_id、wear_date、photo_url、note、created_at等",
    "实现CRUD操作（增删改查）",
    "实现数据导出/导入（备份功能）"
  ],
  "acceptanceCriteria": [
    "数据库创建成功",
    "所有表结构正确（字段、类型、索引）",
    "CRUD操作正常工作",
    "数据持久化（重启App后数据仍在）",
    "查询性能良好（<100ms）"
  ],
  "codeLocations": [
    "新建：mobile-app/src/services/database/closetDatabase.ts",
    "新建：mobile-app/src/services/database/schema.sql"
  ],
  "testStrategy": [
    "单元测试：CRUD操作",
    "集成测试：数据持久化",
    "性能测试：查询速度（1000条数据）"
  ],
  "aiPromptSuggestion": "请帮我实现SQLite本地数据库，要求：\n\n1. **安装依赖**：\n   ```bash\n   npm install react-native-sqlite-storage\n   ```\n\n2. **创建数据库**：\n   ```typescript\n   import SQLite from 'react-native-sqlite-storage';\n\n   SQLite.enablePromise(true);\n\n   export const openDatabase = async () => {\n     return SQLite.openDatabase({\n       name: 'closet.db',\n       location: 'default',\n     });\n   };\n   ```\n\n3. **设计表结构**（schema.sql）：\n   ```sql\n   -- 衣物表\n   CREATE TABLE IF NOT EXISTS clothes (\n     id INTEGER PRIMARY KEY AUTOINCREMENT,\n     image_url TEXT NOT NULL,\n     category TEXT NOT NULL,  -- 18个大类之一\n     color TEXT,              -- 主色调\n     style TEXT,              -- 休闲/正式/运动等\n     brand TEXT,              -- 品牌\n     purchase_date TEXT,      -- 购买时间\n     price REAL,              -- 价格\n     tags TEXT,               -- 标签（JSON数组）\n     note TEXT,               -- 备注\n     created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n     updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\n     synced INTEGER DEFAULT 0  -- 是否已同步到云端\n   );\n\n   -- 搭配表\n   CREATE TABLE IF NOT EXISTS outfits (\n     id INTEGER PRIMARY KEY AUTOINCREMENT,\n     name TEXT NOT NULL,\n     clothes_ids TEXT NOT NULL,  -- JSON数组：[1,2,3]\n     occasion TEXT,              -- 场合：上班/约会/运动/休闲\n     season TEXT,                -- 季节：春/夏/秋/冬\n     created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n     synced INTEGER DEFAULT 0\n   );\n\n   -- 穿搭记录表\n   CREATE TABLE IF NOT EXISTS records (\n     id INTEGER PRIMARY KEY AUTOINCREMENT,\n     outfit_id INTEGER,\n     wear_date TEXT NOT NULL,\n     photo_url TEXT,\n     note TEXT,\n     created_at TEXT DEFAULT CURRENT_TIMESTAMP,\n     FOREIGN KEY (outfit_id) REFERENCES outfits(id)\n   );\n\n   -- 索引\n   CREATE INDEX IF NOT EXISTS idx_clothes_category ON clothes(category);\n   CREATE INDEX IF NOT EXISTS idx_records_wear_date ON records(wear_date);\n   ```\n\n4. **实现CRUD操作**：\n   ```typescript\n   // 添加衣物\n   export const addCloth = async (db, cloth) => {\n     await db.executeSql(\n       'INSERT INTO clothes (image_url, category, color, style, brand, price, tags, note) VALUES (?, ?, ?, ?, ?, ?, ?, ?)',\n       [cloth.image_url, cloth.category, cloth.color, cloth.style, cloth.brand, cloth.price, JSON.stringify(cloth.tags), cloth.note]\n     );\n   };\n\n   // 查询所有衣物\n   export const getAllClothes = async (db) => {\n     const results = await db.executeSql('SELECT * FROM clothes ORDER BY created_at DESC');\n     return results[0].rows.raw();\n   };\n\n   // 删除衣物\n   export const deleteCloth = async (db, id) => {\n     await db.executeSql('DELETE FROM clothes WHERE id = ?', [id]);\n   };\n   ```\n\n5. **初始化数据库**（App启动时）：\n   ```typescript\n   const initDatabase = async () => {\n     const db = await openDatabase();\n     await db.executeSql(schema); // 执行schema.sql\n   };\n   ```\n\n参考问题9的数据结构设计。"
}
```

---

## 任务卡输出格式要求

### 必须包含的18个字段

1. **taskId**（字符串）：任务卡唯一ID，格式：`{模块}-{部门}-{序号}`
   - 例如：`APP-RN-001`、`APP-AUTH-002`、`APP-AI-003`

2. **department**（字符串）：负责部门
   - 可选值：`react_native_基础搭建`、`用户认证模块`、`服装AI功能模块`、`智能衣柜模块`、`支付与订单模块`、`电商导流模块`、`测试与优化部门`

3. **module**（字符串）：所属模块
   - 例如：`项目初始化`、`登录注册`、`智能抠图`、`衣物管理`

4. **title**（字符串）：任务卡标题（一句话描述任务）
   - 例如：`初始化React Native项目并配置基础环境`

5. **phase**（字符串）：所属阶段
   - 格式：`Phase X - Week Y`
   - 例如：`Phase 1 - Week 1`、`Phase 2 - Week 3`

6. **estimatedHours**（数字）：预计工作量（小时）
   - 范围：4-16小时
   - 例如：`8`

7. **priority**（字符串）：优先级
   - 可选值：`P0`（MVP必须）、`P1`（重要）、`P2`（优化）
   - 例如：`P0`

8. **dependencies**（数组）：依赖的其他任务卡
   - 格式：`["APP-RN-001", "APP-RN-005"]`
   - 例如：`["APP-RN-001"]`（依赖任务卡APP-RN-001）

9. **needsCoordination**（数组）：需要协调的其他部门
   - 格式：`["backend_dev（验证码API）", "frontend_dev（Web端）"]`
   - 例如：`["backend_dev（验证码API）"]`

10. **description**（字符串）：任务详细描述（2-3句话）
    - 例如：`创建React Native项目，选择合适的版本，配置基础开发环境`

11. **technicalRequirements**（数组）：技术要求（5-10条）
    - 例如：`["使用React Native 0.72 LTS版本", "配置TypeScript支持"]`

12. **acceptanceCriteria**（数组）：验收标准（5-8条）
    - 例如：`["项目可以在iOS和Android模拟器上成功运行", "代码规范检查通过"]`

13. **codeLocations**（数组）：代码位置（新建文件或修改文件）
    - 例如：`["新建：mobile-app/src/screens/auth/LoginScreen.tsx", "参考：frontend/src/pages/auth/login.tsx"]`

14. **testStrategy**（数组）：测试策略（4-6条）
    - 例如：`["手动测试：iOS模拟器启动", "自动测试：npm run lint"]`

15. **aiPromptSuggestion**（字符串）：**给Claude Code的提示词建议**（重要！）
    - 格式：详细的、可直接使用的提示词，包含：
      1. 安装依赖命令
      2. 代码实现要求
      3. 配置文件修改
      4. 参考文件位置
      5. 验证步骤
    - 字数：500-1000字

16. **riskPoints**（数组，可选）：风险点
    - 例如：`["iOS审核可能被拒（需集成Apple登录）"]`

17. **notes**（字符串，可选）：补充说明
    - 例如：`此任务需要安装Xcode 14+`

18. **relatedDocs**（数组，可选）：相关文档
    - 例如：`["问题9（智能衣柜系统设计）", "问题11（App开发战略）"]`

---

## 任务卡分组要求

所有任务卡必须按照以下7个部门分组输出：

### 1. React Native基础搭建部门（5-8个任务卡）
- 项目初始化、环境配置、导航、状态管理、网络请求等

### 2. 用户认证模块部门（4-6个任务卡）
- 登录注册、第三方登录、会员中心等

### 3. 服装AI功能模块部门（8-12个任务卡）
- 5个AI功能（抠图、消除笔、换装、换脸、扩图）、任务列表、结果展示等

### 4. 智能衣柜模块部门（10-15个任务卡）
- 衣物管理、搭配推荐、穿搭记录、数据同步等

### 5. 支付与订单模块部门（3-5个任务卡）
- 支付宝/微信支付、套餐购买、订单查询等

### 6. 电商导流模块部门（可选，3-5个任务卡）
- 商品推荐、Deep Link跳转、转化追踪等

### 7. 测试与优化部门（4-6个任务卡）
- 单元测试、E2E测试、性能优化、上线准备等

---

## aiPromptSuggestion编写要求

**这是最重要的字段！**必须写得详细、具体、可直接使用。

### 标准格式

```
请帮我实现[功能名称]，要求：

1. **安装依赖**：
   ```bash
   npm install package-name
   ```

2. **创建文件**：
   - 位置：mobile-app/src/...
   - 参考：frontend/src/...（Web端实现）

3. **代码实现**：
   ```typescript
   // 关键代码示例
   ```

4. **配置修改**：
   - 修改文件：xxx
   - 修改内容：xxx

5. **验证步骤**：
   - 命令：xxx
   - 预期结果：xxx

6. **注意事项**：
   - 重点1
   - 重点2

参考文档：https://...
```

### 示例（好的aiPromptSuggestion）

```json
{
  "aiPromptSuggestion": "请帮我实现登录页面UI，要求：\n\n1. **创建LoginScreen组件**：\n   - 位置：mobile-app/src/screens/auth/LoginScreen.tsx\n   - 参考Web端：frontend/src/pages/auth/login.tsx\n\n2. **页面结构**：\n   - 顶部：Logo + Slogan\n   - 中部：手机号输入框 + 验证码输入框 + 登录按钮\n   - 底部：微信登录 + Apple登录 + 用户协议链接\n\n3. **手机号输入框**：\n   - 使用TextInput组件\n   - keyboardType=\"phone-pad\"\n   - maxLength=11\n   - 实时校验格式（/^1[3-9]\\d{9}$/）\n\n4. **验证码输入框**：\n   - 使用TextInput组件\n   - keyboardType=\"number-pad\"\n   - maxLength=6\n   - 右侧：发送验证码按钮（60秒倒计时）\n\n5. **登录按钮**：\n   - 使用TouchableOpacity组件\n   - 显示loading状态（ActivityIndicator）\n   - 禁用状态（手机号或验证码为空时）\n\n6. **表单校验**：\n   - 手机号格式校验\n   - 验证码非空校验\n   - 错误提示（Toast或Alert）\n\n7. **样式**：\n   - 参考Web端的设计风格\n   - 使用品牌色（主色、辅色）\n   - 响应式布局（适配不同屏幕尺寸）"
}
```

---

## 总结

请严格按照以上格式输出30-50个任务卡，每个任务卡必须包含18个字段，其中**aiPromptSuggestion字段是最重要的**，必须写得详细、具体、可直接交给Claude Code执行。
