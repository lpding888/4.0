# 问题19：安全加固与高并发性能优化 + 20-30个AI任务卡

> **问题类型**：安全加固 + 性能优化 + 任务卡生成
> **优先级**：P0（上线前必须完成）
> **预计思考时间**：20-30分钟
> **预计输出字数**：12000-18000字
> **前置依赖**：现有项目（前端+后端）

---

## 背景说明

我的项目即将正式商用，需要进行全面的安全加固和性能优化，确保：
1. **安全性**：防止黑客攻击、数据泄露、恶意请求
2. **稳定性**：支持高并发、防止服务崩溃
3. **合规性**：符合数据安全法、个人信息保护法

我需要你**输出全面的安全加固和性能优化方案，以及20-30个AI任务卡**。

---

## 核心问题

请你深度规划以下内容，**输出可以直接交给AI团队执行的20-30个任务卡**：

### 第一部分：安全加固方案（5000-8000字）

#### 1. Web安全防护
- **XSS防护**：
  - 输入验证和输出编码
  - CSP（Content Security Policy）配置
  - HTTP-only Cookie

- **CSRF防护**：
  - CSRF Token验证
  - SameSite Cookie属性

- **SQL注入防护**：
  - 参数化查询（Knex.js）
  - 输入验证和过滤

- **点击劫持防护**：
  - X-Frame-Options头
  - CSP frame-ancestors指令

#### 2. API安全防护
- **认证和鉴权**：
  - JWT Token安全（密钥强度、过期时间、续期策略）
  - RBAC权限控制（角色、权限、资源）
  - API密钥管理（不同客户端不同密钥）

- **请求限流**：
  - IP级限流（防止恶意请求）
  - 用户级限流（防止滥用）
  - 接口级限流（敏感接口更严格）

- **敏感数据保护**：
  - 数据加密（传输加密HTTPS、存储加密）
  - 敏感字段脱敏（手机号、身份证号）
  - 日志脱敏（不记录敏感信息）

#### 3. 服务器安全防护
- **防火墙配置**：
  - 只开放必要端口（80、443、22）
  - 禁止ROOT登录
  - SSH密钥登录

- **HTTPS配置**：
  - SSL证书配置（免费Let's Encrypt）
  - 强制HTTPS重定向
  - HSTS响应头

- **DDoS防护**：
  - CDN加速（腾讯云CDN）
  - IP黑名单
  - 请求频率限制

#### 4. 数据安全
- **数据备份**：
  - 数据库定期备份（每天备份）
  - COS数据备份（异地容灾）
  - 备份恢复演练

- **数据合规**：
  - 用户隐私政策
  - 用户数据导出（GDPR要求）
  - 用户数据删除（注销账号）

---

### 第二部分：性能优化方案（4000-6000字）

#### 5. 前端性能优化
（参考问题15的优化方案）
- 代码分割、图片优化、懒加载
- React性能优化（memo、useMemo、useCallback）
- CDN加速

#### 6. 后端性能优化
（参考问题16的优化方案）
- 数据库索引优化、查询优化
- Redis缓存热点数据
- 异步任务队列

#### 7. 高并发优化
- **负载均衡**：
  - Nginx负载均衡配置
  - PM2集群优化（进程数、内存限制）
  - 健康检查和故障转移

- **缓存策略**：
  - 浏览器缓存（Cache-Control）
  - CDN缓存（静态资源）
  - Redis缓存（API数据）

- **数据库优化**：
  - 读写分离（主从复制）
  - 连接池优化
  - 慢查询优化

---

### 第三部分：任务卡拆分（核心！）

请按照以下部门拆分20-30个任务卡：

#### 8. Web安全部门（5-7个任务卡）
- SEC-WEB-001：XSS防护（CSP配置、输出编码）
- SEC-WEB-002：CSRF防护（CSRF Token）
- SEC-WEB-003：SQL注入防护检查
- SEC-WEB-004：点击劫持防护（X-Frame-Options）
- SEC-WEB-005：安全响应头配置（Helmet）
- SEC-WEB-006：HTTPS强制重定向
- SEC-WEB-007：安全审计和漏洞扫描

#### 9. API安全部门（4-6个任务卡）
- SEC-API-001：JWT Token安全加固
- SEC-API-002：RBAC权限控制
- SEC-API-003：全局限流中间件
- SEC-API-004：敏感数据加密和脱敏
- SEC-API-005：API密钥管理
- SEC-API-006：日志脱敏

#### 10. 服务器安全部门（3-5个任务卡）
- SEC-SERVER-001：防火墙配置和端口管理
- SEC-SERVER-002：SSH密钥登录配置
- SEC-SERVER-003：DDoS防护和IP黑名单
- SEC-SERVER-004：SSL证书配置和HSTS
- SEC-SERVER-005：服务器安全加固检查

#### 11. 数据安全部门（3-5个任务卡）
- SEC-DATA-001：数据库定期备份策略
- SEC-DATA-002：COS数据异地备份
- SEC-DATA-003：备份恢复演练
- SEC-DATA-004：用户隐私政策和数据合规
- SEC-DATA-005：用户数据导出和删除功能

#### 12. 性能优化部门（5-7个任务卡）
- PERF-CONCUR-001：Nginx负载均衡配置
- PERF-CONCUR-002：PM2集群优化
- PERF-CONCUR-003：Redis缓存策略优化
- PERF-CONCUR-004：数据库读写分离（可选）
- PERF-CONCUR-005：CDN加速配置
- PERF-CONCUR-006：压力测试和性能调优
- PERF-CONCUR-007：监控和告警系统

---

### 第四部分：实施路线图（2000-3000字）

#### 13. 分阶段实施建议
- **Phase 1（Week 1）**：Web安全和API安全
- **Phase 2（Week 2）**：服务器安全和数据安全
- **Phase 3（Week 3）**：性能优化和高并发优化
- **Phase 4（Week 4）**：压力测试和上线准备

#### 14. 验收标准
- **安全指标**：
  - 通过安全扫描（0个高危漏洞）
  - 通过渗透测试
  - HTTPS评分A+（SSL Labs测试）

- **性能指标**：
  - 并发能力：支持1000人同时在线
  - API响应时间：<100ms
  - Lighthouse性能评分：>90分

- **稳定性指标**：
  - 7×24小时稳定运行
  - 服务可用性：>99.9%
  - 故障恢复时间：<5分钟

---

## 输出要求

### 格式要求
1. **任务卡必须使用标准JSON格式**
2. **每个任务卡必须包含18个字段**
3. **任务卡按部门分组输出**

### 质量要求
- ✅ 安全方案全面（覆盖Web安全、API安全、服务器安全、数据安全）
- ✅ 性能方案有效（支持高并发、低延迟）
- ✅ 任务卡可以直接交给AI团队执行

---

## 预期输出

**总字数**：12000-18000字
**思考时间**：20-30分钟
**任务卡数量**：20-30个

---

开始规划安全加固和性能优化方案！
