# 任务卡 - QA测试验收 (用户积分系统)

> **系统**: 用户积分系统
> **负责人**: QA Acceptance Skill
> **预计工期**: 2天
> **优先级**: P0
> **依赖**: 前端、后端、管理端开发全部完成

---

## 📋 任务概述

对用户积分系统进行全面的功能测试和验收，确保所有功能正常、数据准确、用户体验良好。

---

## 🧪 测试场景

### 场景1: 用户注册获得奖励积分

**测试步骤**：
1. 注册新用户账号
2. 登录后查看积分账户
3. 查看积分明细

**预期结果**：
- [ ] 可用积分=100
- [ ] 累计获得=100
- [ ] 积分明细中有1条"注册奖励"记录，+100积分
- [ ] 积分有效期为365天

**异常测试**：
- [ ] 同一用户重复注册，不应再次发放积分

---

### 场景2: 每日签到获得积分

**测试步骤**：
1. 用户首次签到
2. 查看积分账户和签到状态
3. 连续5天每天签到
4. 中断1天后再签到

**预期结果**：
- [ ] 第1天签到获得2积分
- [ ] 第2天签到获得4积分
- [ ] 第3天签到获得6积分
- [ ] 第4天签到获得8积分
- [ ] 第5天签到获得10积分
- [ ] 第6天签到获得10积分（不再递增）
- [ ] 中断后重新签到获得2积分（连续天数重置）
- [ ] 签到日历正确显示本周签到状态

**异常测试**：
- [ ] 同一天重复签到，返回错误提示"今天已签到过了"
- [ ] 篡改客户端时间签到，应该失败

---

### 场景3: 完成任务获得积分

#### 3.1 一次性任务

**测试步骤**：
1. 完成"完善个人资料"任务（填写头像+昵称+简介）
2. 完成"首次使用AI功能"任务
3. 完成"首次购买会员"任务

**预期结果**：
- [ ] 完善资料获得20积分
- [ ] 首次使用获得30积分
- [ ] 首次购买获得100积分
- [ ] 任务状态显示"已完成"（✅）

**异常测试**：
- [ ] 重复完成一次性任务，返回错误提示"该任务已完成"

#### 3.2 可重复任务（每日限制）

**测试步骤**：
1. 分享作品3次（每次10积分）
2. 尝试第4次分享
3. 评价生成结果10次（每次5积分）
4. 尝试第11次评价

**预期结果**：
- [ ] 前3次分享成功，各获得10积分
- [ ] 第4次分享失败，提示"该任务每天最多完成3次"
- [ ] 前10次评价成功，各获得5积分
- [ ] 第11次评价失败，提示"该任务每天最多完成10次"

#### 3.3 可重复任务（每月限制）

**测试步骤**：
1. 邀请5个好友注册（每人50积分）
2. 尝试邀请第6个好友

**预期结果**：
- [ ] 前5个邀请成功，各获得50积分
- [ ] 第6个邀请失败，提示"该任务每月最多完成5次"

---

### 场景4: 购买会员赠送积分

**测试步骤**：
1. 用户购买99元/月会员
2. 支付成功后查看积分账户

**预期结果**：
- [ ] 可用积分增加9积分（99元÷10=9积分）
- [ ] 积分明细中有1条"购买会员赠送积分"记录

**异常测试**：
- [ ] 用户退款后，积分应被扣除

---

### 场景5: 兑换配额

**测试步骤**：
1. 用户当前可用积分=850
2. 兑换8个配额（800积分）
3. 查看积分账户和配额余额

**预期结果**：
- [ ] 可用积分减少800，剩余50
- [ ] 配额余额增加8个
- [ ] 积分明细中有1条"兑换8个处理配额"记录，-800积分
- [ ] 兑换记录表中有1条记录

**异常测试**：
- [ ] 积分不足时兑换，返回错误提示"可用积分不足"
- [ ] 兑换数量<1或>50，返回错误提示
- [ ] 并发兑换测试（10个并发请求同时兑换，只有1个成功）

---

### 场景6: 兑换商城商品（优惠券）

**测试步骤**：
1. 用户当前可用积分=850
2. 兑换"50元优惠券"（500积分）
3. 查看积分账户和优惠券列表

**预期结果**：
- [ ] 可用积分减少500，剩余350
- [ ] 优惠券列表中有1张50元优惠券
- [ ] 优惠券码格式正确（COUP-XXXXXXXX）
- [ ] 优惠券有效期为30天
- [ ] 积分明细中有1条"兑换50元优惠券"记录

**异常测试**：
- [ ] 同一用户本月已兑换2张50元优惠券，第3次兑换失败，提示"该商品每月最多兑换2次"
- [ ] 积分不足时兑换，返回错误提示

---

### 场景7: 兑换商城商品（会员）

**测试步骤**：
1. 用户当前可用积分=2500，会员到期时间为2025-11-01
2. 兑换"1个月会员"（2000积分）
3. 查看积分账户和会员信息

**预期结果**：
- [ ] 可用积分减少2000，剩余500
- [ ] 会员到期时间延长30天，变为2025-12-01
- [ ] 积分明细中有1条"兑换1个月会员"记录

**特殊情况**：
- [ ] 用户当前不是会员（会员已过期），兑换后会员到期时间为当前时间+30天

---

### 场景8: 积分明细查询

**测试步骤**：
1. 查看全部积分明细
2. 筛选"获得"类型
3. 筛选"消费"类型
4. 筛选"过期"类型
5. 分页查询（每页20条）

**预期结果**：
- [ ] 全部明细按时间倒序排列（最新的在前面）
- [ ] 筛选"获得"只显示+号记录（绿色）
- [ ] 筛选"消费"只显示-号记录（红色）
- [ ] 筛选"过期"只显示过期记录（灰色）
- [ ] 分页功能正常

---

### 场景9: 积分过期清理

**测试步骤**：
1. 修改测试用户的积分记录，设置`expire_at=昨天`
2. 等待定时任务执行（或手动触发）
3. 查看积分账户和积分明细

**预期结果**：
- [ ] 可用积分减少
- [ ] 已过期积分增加
- [ ] 积分明细中有1条"积分过期"记录
- [ ] 过期的积分记录`is_expired=true`

---

### 场景10: 管理员手动调整积分

**测试步骤**：
1. 管理员登录管理后台
2. 搜索用户（按user_id或phone）
3. 手动增加100积分，原因"补偿用户"
4. 手动减少50积分，原因"扣除违规积分"

**预期结果**：
- [ ] 用户可用积分增加100
- [ ] 积分明细中有1条"补偿用户"记录，+100积分
- [ ] 用户可用积分减少50
- [ ] 积分明细中有1条"扣除违规积分"记录，-50积分

---

### 场景11: 管理员冻结/解冻积分

**测试步骤**：
1. 管理员冻结用户500积分，原因"异常行为"
2. 查看用户积分账户
3. 用户尝试使用积分兑换配额
4. 管理员解冻500积分
5. 用户再次尝试兑换配额

**预期结果**：
- [ ] 冻结后，可用积分减少500，冻结积分增加500
- [ ] 冻结期间用户无法使用被冻结的积分
- [ ] 解冻后，可用积分增加500，冻结积分减少500
- [ ] 解冻后用户可以正常使用积分

---

### 场景12: 管理员管理商城商品

**测试步骤**：
1. 管理员新增商品"200元优惠券"，所需积分1800，每月限1次
2. 查看商城商品列表
3. 用户端查看商城，尝试兑换新商品
4. 管理员下架该商品
5. 用户端再次查看商城

**预期结果**：
- [ ] 新增商品成功，商城列表中显示
- [ ] 用户端可以看到并兑换新商品
- [ ] 下架后，用户端商城不再显示该商品
- [ ] 已兑换的商品不受影响

---

### 场景13: 管理员查看统计数据

**测试步骤**：
1. 管理员查看积分统计大盘
2. 查看趋势图（最近30天）
3. 查看分布图

**预期结果**：
- [ ] 总发放积分、总消费积分、过期积分数据正确
- [ ] 签到人次、兑换配额数量、兑换会员数量数据正确
- [ ] 趋势图正确显示每天的发放和消费数据
- [ ] 分布图正确显示各类型消费占比

---

## 🎨 UI/UX测试

### UI测试

**页面渲染**：
- [ ] 所有页面正常加载，无白屏或报错
- [ ] 暗色主题样式正确（黑色背景+青色高亮）
- [ ] 玻璃卡片效果正常（毛玻璃+边框）
- [ ] 按钮渐变效果正常
- [ ] 字体大小和间距合理

**响应式设计**：
- [ ] 手机端（375px宽度）显示正常
- [ ] 平板端（768px宽度）显示正常
- [ ] 桌面端（1920px宽度）显示正常

---

### UX测试

**加载状态**：
- [ ] 数据加载时显示Loading骨架屏
- [ ] 按钮点击后显示Loading状态（禁用+转圈）

**错误提示**：
- [ ] 所有错误都有友好的提示信息
- [ ] 表单校验错误在输入框下方显示红色提示

**成功反馈**：
- [ ] 签到成功后显示"签到成功"Toast提示
- [ ] 兑换成功后显示成功弹窗（包含结果信息）
- [ ] 任务完成后显示"任务完成"Toast提示

**空状态**：
- [ ] 积分明细为空时显示"暂无记录"
- [ ] 商城商品为空时显示"暂无商品"

---

## 🚨 边界条件测试

### 边界值测试

- [ ] 积分数值为0时的显示和操作
- [ ] 积分数值非常大（>1000000）时的显示
- [ ] 兑换数量为1时（最小值）
- [ ] 兑换数量为50时（最大值）
- [ ] 连续签到365天后的积分计算

### 异常输入测试

- [ ] 兑换数量输入负数，应拒绝
- [ ] 兑换数量输入小数，应拒绝
- [ ] 兑换数量输入非数字，应拒绝
- [ ] 兑换数量为0，应拒绝

---

## 🔐 安全性测试

### 权限测试

- [ ] 未登录用户访问积分页面，跳转登录页
- [ ] 普通用户访问管理员页面，返回403错误
- [ ] Token过期后访问积分接口，返回401错误

### 数据安全测试

- [ ] 用户只能查看自己的积分明细，无法查看他人的
- [ ] 用户只能兑换自己的积分，无法操作他人的
- [ ] 管理员可以查看和操作所有用户的积分

---

## 🏎️ 性能测试

### 接口响应时间

- [ ] 查询积分账户接口响应时间<100ms
- [ ] 签到接口响应时间<200ms
- [ ] 兑换配额接口响应时间<300ms
- [ ] 查询积分明细接口响应时间<200ms

### 并发测试

- [ ] 100个并发请求签到，无报错
- [ ] 100个并发请求兑换配额，积分不超扣
- [ ] 100个并发请求查询积分账户，响应时间正常

---

## 📊 数据准确性测试

### 积分账户一致性

- [ ] 可用积分 = 累计获得 - 冻结积分 - 已使用 - 已过期
- [ ] 所有积分变动都有对应的流水记录
- [ ] 积分流水的余额字段正确（balance_before和balance_after）

### FIFO消费验证

- [ ] 创建测试用户，发放3条不同过期时间的积分
- [ ] 消费积分，查询`points_consumptions`表
- [ ] 验证优先消耗即将过期的积分

---

## ✅ 验收标准

### 功能完整性

- [ ] 13个测试场景全部通过
- [ ] 所有API接口正常工作
- [ ] 所有页面功能正常

### 数据准确性

- [ ] 积分账户数据一致性验证通过
- [ ] FIFO消费逻辑验证通过
- [ ] 防重复发放验证通过

### 用户体验

- [ ] UI/UX测试全部通过
- [ ] 响应式设计测试通过
- [ ] 加载状态和错误提示完善

### 性能和安全

- [ ] 性能测试通过（响应时间达标）
- [ ] 并发测试通过（无超扣问题）
- [ ] 权限测试通过（无越权访问）

---

## 📝 测试报告

测试完成后，需要输出测试报告，包括：

1. **测试概述**
   - 测试时间
   - 测试环境
   - 测试范围

2. **测试结果**
   - 通过的测试场景
   - 失败的测试场景（包含详细错误信息）
   - Bug列表（包含严重等级、复现步骤、截图）

3. **性能数据**
   - 接口响应时间统计
   - 并发测试结果

4. **验收结论**
   - 是否通过验收
   - 遗留问题和风险

---

## 🐛 Bug优先级定义

- **P0 (致命)**: 系统崩溃、数据丢失、积分超发/超扣、无法登录
- **P1 (严重)**: 核心功能无法使用、数据显示错误、严重的UI问题
- **P2 (一般)**: 非核心功能异常、轻微的UI问题、性能问题
- **P3 (建议)**: 优化建议、体验改进

---

**测试完成后，输出测试报告并通知开发团队修复Bug！**
